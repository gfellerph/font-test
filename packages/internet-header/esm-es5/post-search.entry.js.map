{"version":3,"names":["getTrackAndTraceApiUrl","id","lang","state","currentLanguage","concat","encodeURIComponent","getTrackAndTraceRedirectUrl","query","_q","packageTrackingRedirectUrl","replace","isParcel","searchConfig","__awaiter","getParcelInfo","parcelInfo","sent","ok","redirectPattern","trackingNrPattern","RegExp","test","fetch","trackAndTraceReqest","_r","json","trackAndTraceResult","Object","assign","console","warn","error_1","message","timestamp","Date","toDateString","getParcelSuggestion","url","getSearchRedirectUrl","isTrackTraceId","getSearchPageUrl","_a","localizedConfig","header","search","undefined","searchPageUrl","searchParam","equalizeArrays","arrayA","arrayB","maxLength","coveoSliced","slice","Math","max","length","coveo","environment","prod","organisation","token","int01","int02","dev01","dev02","devs1","getCoveoSuggestions","_b","config","searchHubName","searchPipelineName","method","headers","Authorization","coveoResponse","coveoJSON","coveoCompletions","completions","map","completion","redirectUrl","expression","error","gisAPIUrl","placesUrl","pois","hardNormalize","str","toLowerCase","normalize","typesCache","convertTypes","typesResponse","typesJSON_1","poi","foundType","types","find","type","tag","filter","join","error_3","queryPlaces","limit","excludeTypes","geocoderUrl","geocodeResponse","geocodeJSON","Error","info","locations","location","includes","error_4","highlightPlacesString","place","reference","q","indexOfQuery","indexOf","substring","getPlacesUrl","name","HighlightedText","props","highlightClass","highlightedString","text","h","innerHTML","postSearchCss","PostSearch","class_1","prototype","connectedCallback","_this","this","throttledResize","throttle","handleResize","window","addEventListener","passive","disconnectedCallback","removeEventListener","clearAllBodyScrollLocks","componentWillUpdate","searchFlyout","searchDropdownOpen","classList","remove","elementHasTransition","userPrefersReducedMotion","Promise","resolve","event","propertyName","componentDidUpdate","getBoundingClientRect","add","searchBox","focus","preventScroll","toggleDropdown","force","dropdownToggled","emit","open","element","host","coveoSuggestions","placeSuggestions","value","setFocus","setBodyScroll","shadowRoot","toggleButton","querySelector","innerWidth","disableBodyScroll","enableBodyScroll","handleSearchInput","trim","all","_s","trackAndTraceInfo","parcelSuggestion","deselectSuggestion","handleKeyDown","selectedSuggestion","key","selectedHref","getAttribute","href","startSearch","suggestions","querySelectorAll","parentElement","nextElementSibling","firstElementChild","_d","_c","previousElementSibling","suggestedText","dataset","suggestionText","handleMouseEnterSuggestion","target","handleMouseLeaveSuggestions","render","translations","showPortalRecommendations","searchRecommendations","links","Host","SvgSprite","class","onClick","e","searchToggleExpanded","searchToggle","SvgIcon","If","condition","ref","placeholder","flyoutSearchBoxFloatingLabel","autocomplete","el","onInput","onKeyDown","htmlFor","searchSubmit","title","onMouseLeave","recommendation","URL","label","onMouseEnter","inlineSvg","_f","_e","sending","_h","_g","product","_k","_j","recipient","zipcode","_m","_l","city","_p","_o","suggestion","objectId","highlighted"],"sources":["src/services/search/parcel.service.ts","src/services/search/search.service.ts","src/services/search/coveo.settings.ts","src/services/search/coveo.service.ts","src/services/search/places.settings.ts","src/services/search/search-utilities.ts","src/services/search/places.service.ts","src/utils/highlighted.component.tsx","src/components/post-search/post-search.scss?tag=post-search&encapsulation=shadow","src/components/post-search/post-search.tsx"],"sourcesContent":["import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\n\r\n// https://www.post.ch/api/trackandtrace?id=99.00.306600.01004883\r\n\r\n// Track and trace URL\r\nexport const getTrackAndTraceApiUrl = (id: string) => {\r\n  const lang = state.currentLanguage;\r\n  return `https://www.post.ch/${lang}/api/trackandtrace?id=${encodeURIComponent(id)}`;\r\n};\r\n\r\n// Get the redire\r\nexport const getTrackAndTraceRedirectUrl = (\r\n  query: string,\r\n  { packageTrackingRedirectUrl }: ISearchConfig,\r\n) => {\r\n  return packageTrackingRedirectUrl.replace('{trackingNumber}', encodeURIComponent(query));\r\n};\r\n\r\n/**\r\n * Check whether a query is a tracking id\r\n *\r\n * @param query User query\r\n * @returns Boolean\r\n */\r\nexport const isParcel = async (query: string, searchConfig: ISearchConfig): Promise<boolean> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok;\r\n};\r\n\r\n/**\r\n * Try to get parcel info from a query that is possibly a tracking id.\r\n * This is mainly used to check if a search should redirect to track&trace instead of the regular search.\r\n *\r\n * @param query User query that is possibly a tracking number\r\n * @returns Track and trace info\r\n */\r\nexport const getParcelInfo = async (\r\n  query: string,\r\n  { redirectPattern }: ISearchConfig,\r\n): Promise<TrackAndTraceInfo> => {\r\n  const trackingNrPattern = new RegExp(redirectPattern);\r\n\r\n  if (trackingNrPattern.test(query)) {\r\n    try {\r\n      const trackAndTraceReqest = await fetch(getTrackAndTraceApiUrl(query));\r\n      const trackAndTraceResult = await trackAndTraceReqest.json();\r\n      return { ...trackAndTraceResult, ok: trackAndTraceResult.ok === 'true' };\r\n    } catch (error) {\r\n      console.warn(`Could not check track and trace API due to error: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  return { ok: false, timestamp: new Date().toDateString() };\r\n};\r\n\r\n/**\r\n * Get parcel info if query is a parcel or null\r\n *\r\n * @param query Parcel id\r\n * @returns Parcel info and a redirect url or null if not a parcel\r\n */\r\nexport const getParcelSuggestion = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<(TrackAndTraceInfo & { url: string }) | null> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok\r\n    ? { ...parcelInfo, url: getTrackAndTraceRedirectUrl(query, searchConfig) }\r\n    : null;\r\n};\r\n","import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { getTrackAndTraceRedirectUrl, isParcel } from './parcel.service';\r\n\r\n/**\r\n * Construct a search page url from a query\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getSearchRedirectUrl = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<string | undefined> => {\r\n  const isTrackTraceId = await isParcel(query, searchConfig);\r\n  return isTrackTraceId\r\n    ? getTrackAndTraceRedirectUrl(query, searchConfig)\r\n    : getSearchPageUrl(query);\r\n};\r\n\r\n/**\r\n * Stitch toghether the search page URL\r\n *\r\n * @param query Search term\r\n * @returns Search page URL\r\n */\r\nexport const getSearchPageUrl = (query: string): string | undefined => {\r\n  if (state.localizedConfig?.header.search === undefined) {\r\n    return;\r\n  }\r\n  const { searchPageUrl } = state.localizedConfig.header.search;\r\n  const searchParam = `#q=${encodeURIComponent(query)}`;\r\n  return `${searchPageUrl}${searchParam}&t=AllTab`;\r\n};\r\n\r\n/**\r\n * Equalize the length of two arrays while filling up empty slots up to max. length\r\n *\r\n * @param arrayA First array\r\n * @param arrayB Second array\r\n * @param maxLength Max. length of result array\r\n * @returns Array with two resulting arrays\r\n */\r\nexport const equalizeArrays = <A, B>(arrayA: A[], arrayB: B[], maxLength = 8): [A[], B[]] => {\r\n  const coveoSliced = arrayA.slice(0, Math.max(maxLength / 2, maxLength - arrayB.length));\r\n  return [coveoSliced, arrayB.slice(0, maxLength - coveoSliced.length)];\r\n};\r\n","import { CoveoOptions } from '../../models/coveo.model';\r\n\r\n// Coveo constants\r\nexport const coveo: CoveoOptions = {\r\n  url: 'https://platform-eu.cloud.coveo.com/rest/search/v2/querySuggest',\r\n  environment: {\r\n    prod: {\r\n      organisation: 'postchagprod6ef4sbet',\r\n      token: 'xx5b629890-23b9-4fbe-b601-0e8719186969',\r\n    },\r\n    int01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    int02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    devs1: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    test: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n  },\r\n};\r\n","import { state } from '../../data/store';\r\nimport { CoveoCompletion, CoveoResponse } from '../../models/coveo.model';\r\nimport { coveo } from './coveo.settings';\r\nimport { getSearchPageUrl } from './search.service';\r\n\r\n/**\r\n * Get suggestions from coveo\r\n * https://docs.coveo.com/en/1459/build-a-search-ui/get-query-suggestions#context-object\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getCoveoSuggestions = async (query: string): Promise<CoveoCompletion[]> => {\r\n  if (state.localizedConfig?.header?.search === undefined) return [];\r\n  const config = state.localizedConfig.header.search;\r\n  const { token, organisation } = coveo.environment[state.environment];\r\n  const url = `${coveo.url}?q=${query}&locale=${state.currentLanguage}&searchHub=${config.searchHubName}&pipeline=${config.searchPipelineName}&organizationId=${organisation}`;\r\n  let coveoCompletions: CoveoCompletion[] | undefined;\r\n\r\n  try {\r\n    const coveoResponse = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    const coveoJSON = (await coveoResponse.json()) as CoveoResponse;\r\n    coveoCompletions = coveoJSON.completions.map(completion => ({\r\n      ...completion,\r\n      redirectUrl: getSearchPageUrl(completion.expression),\r\n    }));\r\n  } catch (error) {\r\n    console.error(\r\n      'Connection to coveo failed. Did you add \"*.coveo.com\" to your connect-src content security policy and tried turning off your adblocker?',\r\n    );\r\n  }\r\n\r\n  return coveoCompletions === undefined ? [] : coveoCompletions;\r\n};\r\n","// Implement some TOPOS logic into the header search\r\nexport const gisAPIUrl = 'https://places.post.ch/StandortSuche/StaoCacheService';\r\nexport const placesUrl = 'https://places.post.ch';\r\nexport const pois = [\r\n  '001PST',\r\n  '001MP24',\r\n  '001AG-PICK',\r\n  '001PFFIL',\r\n  '001PFST',\r\n  '001BZ',\r\n  '001LZB',\r\n  '001PZ',\r\n  '001LZP',\r\n  '001AL',\r\n];\r\n","/**\r\n * Transform to lowercase, extract accents to separate unicode chars,\r\n * replace all accent unicode chars so only standard latin chars remain\r\n * https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript/37511463#37511463\r\n *\r\n * @param str Input string\r\n * @returns\r\n */\r\nexport const hardNormalize = (str: string): string =>\r\n  str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '');\r\n","import { state } from '../../data/store';\r\nimport { GeocodeLocation, GeocodeResponse, ServiceTypesResponse } from '../../models/geocode.model';\r\nimport { gisAPIUrl, pois, placesUrl } from './places.settings';\r\nimport { hardNormalize } from './search-utilities';\r\n\r\n// Never load types twice\r\nlet typesCache: string | null = null;\r\n\r\n/**\r\n * Convert Post POI ids to stao cache ids\r\n * @returns\r\n */\r\nconst convertTypes = async () => {\r\n  if (typesCache === null) {\r\n    try {\r\n      const typesResponse = await fetch(`${gisAPIUrl}/Types?lang=${state.currentLanguage}`);\r\n      const typesJSON = (await typesResponse.json()) as ServiceTypesResponse;\r\n      typesCache = encodeURIComponent(\r\n        pois\r\n          .map(poi => {\r\n            const foundType = typesJSON.types.find(type => type.id === poi);\r\n            return foundType?.tag;\r\n          })\r\n          .filter(poi => poi !== undefined)\r\n          .join(','),\r\n      );\r\n    } catch (error) {\r\n      console.error(\r\n        'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  return typesCache;\r\n};\r\n\r\n/**\r\n * Query the Gis API for locations and localities (pois)\r\n *\r\n * @param query User input string\r\n * @returns\r\n */\r\nexport const queryPlaces = async (query: string): Promise<GeocodeLocation[]> => {\r\n  if (query.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const limit = 8;\r\n  const excludeTypes = ['address', 'locality', 'region'];\r\n  const types = await convertTypes();\r\n  const geocoderUrl = `${gisAPIUrl}/Geocode?query=${encodeURIComponent(query)}&lang=${\r\n    state.currentLanguage\r\n  }&pois=${types}&limit=33`;\r\n\r\n  try {\r\n    const geocodeResponse = await fetch(geocoderUrl);\r\n    const geocodeJSON = (await geocodeResponse.json()) as GeocodeResponse;\r\n    if (!geocodeJSON.ok) {\r\n      throw new Error(geocodeJSON.info);\r\n    }\r\n    return geocodeJSON.locations\r\n      .filter(location => !excludeTypes.includes(location.type))\r\n      .slice(0, limit);\r\n  } catch (error) {\r\n    console.error(\r\n      'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n    );\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Try to highlight place suggestions\r\n * Limitation: accented chars are not handled by this basic function\r\n *\r\n * @param query Search term\r\n * @param place Name of the suggested place\r\n * @returns\r\n */\r\nexport const highlightPlacesString = (query: string | undefined, place: string) => {\r\n  if (query === undefined) return place;\r\n\r\n  // Strip accents from the string\r\n  const reference = hardNormalize(place);\r\n  const q = hardNormalize(query);\r\n  const indexOfQuery = reference.indexOf(q);\r\n\r\n  if (indexOfQuery < 0) {\r\n    return place;\r\n  }\r\n\r\n  return `${place.substring(0, indexOfQuery)}{${place.substring(\r\n    indexOfQuery,\r\n    indexOfQuery + query.length,\r\n  )}}${place.substring(indexOfQuery + query.length, place.length)}`;\r\n};\r\n\r\n/**\r\n * Get the deeplink to any location found via geocoder\r\n *\r\n * @param location A location from the Gis API Geocode endpoint\r\n * @returns\r\n */\r\nexport const getPlacesUrl = (location: GeocodeLocation): string => {\r\n  let url: string;\r\n\r\n  if (location.id) {\r\n    url = `${placesUrl}/${state.currentLanguage}/${location.id}/detail`;\r\n  } else {\r\n    url = `${placesUrl}?preselecttext=${encodeURIComponent(location.name)}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n","import { h } from '@stencil/core';\r\n\r\nexport const HighlightedText = (props: { text: string; highlightClass?: string }) => {\r\n  const highlightClass = props.highlightClass ?? 'bold';\r\n  const highlightedString = props.text\r\n    .replace(/{/g, `<span class=${highlightClass}>`)\r\n    .replace(/}/g, '</span>')\r\n    .replace(/[\\[\\]]/g, '');\r\n  return <span innerHTML={highlightedString}></span>;\r\n};\r\n","@use \"@swisspost/design-system-styles/variables/color\";\r\n@use \"@swisspost/design-system-styles/components/forms\";\r\n@use \"@swisspost/design-system-styles/components/floating-label\";\r\n@use \"@swisspost/design-system-styles/components/grid\";\r\n@use \"../../utils/utils.scss\";\r\n@use \"../../utils/mixins.scss\";\r\n\r\n:host {\r\n  display: block;\r\n}\r\n\r\n.search,\r\n:host {\r\n  height: 100%;\r\n}\r\n\r\n.search-button {\r\n  @extend %nav-link;\r\n\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  padding-right: calc(1rem - 1px);\r\n  padding-left: calc(1rem - 1px);\r\n\r\n  @include mixins.min(lg) {\r\n    padding: 0 calc(1.125rem - 1px);\r\n  }\r\n\r\n  @include mixins.min(xl) {\r\n    padding: 0 calc(1.5rem - 1px);\r\n  }\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n\r\n  .visually-hidden {\r\n    @include mixins.between(rg, lg) {\r\n      @include mixins.reset-visually-hidden();\r\n\r\n      font-weight: 300;\r\n      margin-right: 0.5rem;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n\r\n.flyout {\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  background: white;\r\n  overflow: auto;\r\n  overscroll-behavior: contain;\r\n  padding-top: 3.25rem;\r\n  padding-bottom: 3.25rem;\r\n  z-index: -1;\r\n  transform: translateY(-100%);\r\n  transition: transform 0.35s, box-shadow 0.35s;\r\n\r\n  @media (prefers-reduced-motion: reduce) {\r\n    transition: none;\r\n  }\r\n\r\n  @include mixins.min(lg) {\r\n    max-height: calc(100vh - var(--header-height) - var(--meta-header-height) - 1px);\r\n    box-shadow: 0 0 1px 0 rgb(0 0 0 / 40%);\r\n\r\n    &.open {\r\n      box-shadow: 0 0 8px 0 rgb(0 0 0 / 40%);\r\n    }\r\n  }\r\n\r\n  @include mixins.max(lg) {\r\n    height: calc(100vh - var(--header-height) - 1px);\r\n  }\r\n\r\n  &.open {\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.start-search-button {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  height: 100%;\r\n  padding-right: 1rem;\r\n  padding-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n}\r\n\r\n.suggestions {\r\n  margin: 1.5rem 0;\r\n\r\n  a {\r\n    padding: 0.75rem 1rem;\r\n\r\n    &:hover,\r\n    &:focus,\r\n    &.selected {\r\n      background: color.$gray-background;\r\n    }\r\n\r\n    &.parcel-suggestion {\r\n      flex-wrap: wrap;\r\n    }\r\n  }\r\n}\r\n\r\n.search-recommendation__icon {\r\n  height: 1.5em;\r\n  width: 1.5em;\r\n}\r\n","import { Component, Host, h, State, Event, EventEmitter, Method, Element } from '@stencil/core';\r\nimport { throttle } from 'throttle-debounce';\r\nimport { disableBodyScroll, enableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock';\r\nimport { state } from '../../data/store';\r\nimport { CoveoCompletion } from '../../models/coveo.model';\r\nimport { GeocodeLocation } from '../../models/geocode.model';\r\nimport {\r\n  DropdownElement,\r\n  DropdownEvent,\r\n  HasDropdown,\r\n  IsFocusable,\r\n} from '../../models/header.model';\r\nimport { getSearchRedirectUrl, equalizeArrays } from '../../services/search/search.service';\r\nimport { getCoveoSuggestions } from '../../services/search/coveo.service';\r\nimport {\r\n  getPlacesUrl,\r\n  highlightPlacesString,\r\n  queryPlaces,\r\n} from '../../services/search/places.service';\r\nimport { userPrefersReducedMotion, elementHasTransition } from '../../services/ui.service';\r\nimport { HighlightedText } from '../../utils/highlighted.component';\r\nimport { SvgSprite } from '../../utils/svg-sprite.component';\r\nimport { SvgIcon } from '../../utils/svg-icon.component';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\nimport { getParcelSuggestion } from '../../services/search/parcel.service';\r\nimport { If } from '../../utils/if.component';\r\n\r\n@Component({\r\n  tag: 'post-search',\r\n  styleUrl: 'post-search.scss',\r\n  shadow: true,\r\n})\r\nexport class PostSearch implements HasDropdown, IsFocusable {\r\n  @State() searchDropdownOpen = false;\r\n  @State() coveoSuggestions: CoveoCompletion[] = [];\r\n  @State() placeSuggestions: GeocodeLocation[] = [];\r\n  @State() parcelSuggestion: (TrackAndTraceInfo & { url: string }) | null = null;\r\n  @Event() dropdownToggled: EventEmitter<DropdownEvent>;\r\n  @Element() host: DropdownElement;\r\n  private searchBox?: HTMLInputElement;\r\n  private searchFlyout: HTMLElement | undefined;\r\n  private throttledResize: throttle<() => void>;\r\n\r\n  connectedCallback() {\r\n    this.throttledResize = throttle(300, () => this.handleResize());\r\n    window.addEventListener('resize', this.throttledResize, { passive: true });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('resize', this.throttledResize);\r\n    clearAllBodyScrollLocks();\r\n  }\r\n\r\n  componentWillUpdate() {\r\n    // Check if search flyout got set to close\r\n    if (this.searchFlyout && !this.searchDropdownOpen) {\r\n      this.searchFlyout.classList.remove('open');\r\n\r\n      // Check if element has transition applied and whether user prefers to see animations or not\r\n      if (elementHasTransition(this.searchFlyout, 'transform') && !userPrefersReducedMotion()) {\r\n        // Wait for CSS transition 'transform' to end before continuing\r\n        return new Promise<boolean>(resolve => {\r\n          if (this.searchFlyout === undefined) {\r\n            return resolve(true);\r\n          }\r\n\r\n          this.searchFlyout.addEventListener('transitionend', event => {\r\n            if (event.propertyName === 'transform') {\r\n              resolve(true);\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // Search flyout got set to open\r\n    if (this.searchFlyout && this.searchDropdownOpen) {\r\n      // Force browser to redraw/refresh DOM before adding 'open' class\r\n      this.searchFlyout.getBoundingClientRect();\r\n      this.searchFlyout.classList.add('open');\r\n    }\r\n\r\n    // Focus on the searchBox whenever the dropdown is opened\r\n    if (this.searchDropdownOpen && this.searchBox) {\r\n      this.searchBox.focus({ preventScroll: true });\r\n    }\r\n  }\r\n\r\n  public async toggleDropdown(event?: Event): Promise<boolean>;\r\n  public async toggleDropdown(force?: boolean): Promise<boolean>;\r\n\r\n  /**\r\n   * Toggle the dropdown and optionally force an open/closed state\r\n   * @param force Boolean to force open/closed state\r\n   * @returns Boolean indicating open state of the component\r\n   */\r\n  @Method()\r\n  async toggleDropdown(force?: unknown) {\r\n    this.searchDropdownOpen =\r\n      force === undefined || typeof force !== 'boolean' ? !this.searchDropdownOpen : force;\r\n    this.dropdownToggled.emit({ open: this.searchDropdownOpen, element: this.host });\r\n\r\n    if (!this.searchDropdownOpen) {\r\n      // Reset suggestions when dropdown closes\r\n      this.coveoSuggestions = [];\r\n      this.placeSuggestions = [];\r\n      if (this.searchBox) this.searchBox.value = '';\r\n      this.setFocus();\r\n    } else {\r\n      // Get basic suggestions when dropdown opens\r\n      try {\r\n        this.coveoSuggestions = await getCoveoSuggestions('');\r\n      } catch {}\r\n    }\r\n\r\n    this.setBodyScroll();\r\n\r\n    return this.searchDropdownOpen;\r\n  }\r\n\r\n  /**\r\n   * Sets the focus on the search button\r\n   */\r\n  @Method()\r\n  public async setFocus() {\r\n    const shadowRoot = this.host.shadowRoot;\r\n    if (shadowRoot === null) {\r\n      return;\r\n    }\r\n    const toggleButton = shadowRoot.querySelector<HTMLElement>('.search-button');\r\n    if (toggleButton) {\r\n      toggleButton.focus();\r\n    }\r\n  }\r\n\r\n  private handleResize() {\r\n    // Only enable/disable body scroll on resize if the search dropdown is open, otherwise this could lead to side effects in other controls\r\n    if (this.searchDropdownOpen) {\r\n      this.setBodyScroll();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable or re-enable body scrolling, depending on whether search dropdown is open or closed in mobile view (width < 1024px)\r\n   */\r\n  private setBodyScroll() {\r\n    if (this.searchDropdownOpen && window.innerWidth < 1024) {\r\n      disableBodyScroll(this.searchFlyout);\r\n    } else {\r\n      enableBodyScroll(this.searchFlyout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch suggestions from all available sources\r\n   */\r\n  private async handleSearchInput() {\r\n    if (this.searchBox === undefined || state.localizedConfig?.header.search === undefined) {\r\n      return;\r\n    }\r\n    const query = this.searchBox.value.trim();\r\n\r\n    const [placeSuggestions, coveoSuggestions, trackAndTraceInfo] = await Promise.all([\r\n      queryPlaces(query),\r\n      getCoveoSuggestions(query),\r\n      getParcelSuggestion(query, state.localizedConfig.header.search),\r\n    ]);\r\n\r\n    // Parcel suggestion is more important than any other\r\n    if (trackAndTraceInfo) {\r\n      this.parcelSuggestion = trackAndTraceInfo;\r\n      this.placeSuggestions = [];\r\n      this.coveoSuggestions = [];\r\n    } else {\r\n      [this.coveoSuggestions, this.placeSuggestions] = equalizeArrays(\r\n        coveoSuggestions,\r\n        placeSuggestions,\r\n        8,\r\n      );\r\n    }\r\n\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Start search on enter\r\n   * @param event\r\n   */\r\n  private handleKeyDown(event: KeyboardEvent) {\r\n    if (this.searchFlyout === undefined) {\r\n      return;\r\n    }\r\n\r\n    let selectedSuggestion = this.searchFlyout.querySelector<HTMLElement>(\r\n      '.suggestions > li > a.selected',\r\n    );\r\n\r\n    switch (event.key.toLowerCase()) {\r\n      case 'enter':\r\n        if (selectedSuggestion) {\r\n          const selectedHref = selectedSuggestion.getAttribute('href');\r\n          if (selectedHref !== null) {\r\n            window.location.href = selectedHref;\r\n          }\r\n        } else {\r\n          this.startSearch();\r\n        }\r\n\r\n        break;\r\n      case 'arrowdown':\r\n      case 'arrowup':\r\n        const suggestions = this.searchFlyout.querySelectorAll('.suggestions > li > a');\r\n\r\n        this.deselectSuggestion();\r\n\r\n        if (event.key.toLowerCase() === 'arrowdown') {\r\n          if (selectedSuggestion?.parentElement?.nextElementSibling?.firstElementChild) {\r\n            // Select next suggestion if there's any, otherwise none will be selected\r\n            selectedSuggestion.parentElement.nextElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select first suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[0].classList.add('selected');\r\n            }\r\n          }\r\n        } else if (event.key.toLowerCase() === 'arrowup') {\r\n          if (selectedSuggestion?.parentElement?.previousElementSibling?.firstElementChild) {\r\n            // Select previous suggestion if there's any, otherwise none will be selected\r\n\r\n            selectedSuggestion.parentElement.previousElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select last suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[suggestions.length - 1].classList.add('selected');\r\n            }\r\n          }\r\n        }\r\n\r\n        // Get the newly selected suggestion\r\n        selectedSuggestion = this.searchFlyout.querySelector('.suggestions > li > a.selected');\r\n        const suggestedText = selectedSuggestion?.dataset.suggestionText;\r\n\r\n        // Update search box value with selected suggestion text\r\n        if (suggestedText !== undefined && this.searchBox) {\r\n          this.searchBox.value = suggestedText;\r\n        }\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseEnterSuggestion(event: MouseEvent) {\r\n    this.deselectSuggestion();\r\n\r\n    // Set hovered suggestion element as selected\r\n    (event.target as HTMLElement).classList.add('selected');\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseLeaveSuggestions() {\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Deselect any previously selected suggestion\r\n   */\r\n  private deselectSuggestion() {\r\n    if (this.searchFlyout === undefined) return;\r\n\r\n    const selectedSuggestion = this.searchFlyout.querySelector('.suggestions .selected');\r\n\r\n    if (selectedSuggestion) {\r\n      selectedSuggestion.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redirect to the post search page\r\n   */\r\n  private async startSearch() {\r\n    if (this.searchBox && state.localizedConfig?.header.search) {\r\n      const redirectUrl = await getSearchRedirectUrl(\r\n        this.searchBox.value.trim(),\r\n        state.localizedConfig.header.search,\r\n      );\r\n      if (!redirectUrl) return;\r\n      window.location.href = redirectUrl;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (state.localizedConfig?.header === undefined) {\r\n      return;\r\n    }\r\n    const { translations, search } = state.localizedConfig.header;\r\n    const showPortalRecommendations =\r\n      this.searchBox?.value === '' && search.searchRecommendations?.links.length > 0;\r\n\r\n    return (\r\n      <Host>\r\n        <SvgSprite />\r\n        <div class=\"search\">\r\n          <button\r\n            id=\"post-internet-header-search-button\"\r\n            class=\"search-button\"\r\n            type=\"button\"\r\n            aria-expanded={`${this.searchDropdownOpen}`}\r\n            onClick={e => this.toggleDropdown(e)}\r\n          >\r\n            <span class=\"visually-hidden\">\r\n              {this.searchDropdownOpen\r\n                ? translations.searchToggleExpanded\r\n                : translations.searchToggle}\r\n            </span>\r\n            <SvgIcon name={this.searchDropdownOpen ? 'pi-close' : 'pi-search'} />\r\n          </button>\r\n          <If condition={this.searchDropdownOpen}>\r\n            <div class=\"flyout\" ref={e => (this.searchFlyout = e)}>\r\n              <div class=\"container box\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-xs-12 col-md-10 col-lg-8\">\r\n                    <div class=\"form-group form-floating\">\r\n                      <input\r\n                        type=\"text\"\r\n                        id=\"searchBox\"\r\n                        class=\"form-control form-control-lg\"\r\n                        placeholder={translations.flyoutSearchBoxFloatingLabel}\r\n                        autocomplete=\"off\"\r\n                        ref={el => (this.searchBox = el)}\r\n                        onInput={() => this.handleSearchInput()}\r\n                        onKeyDown={e => this.handleKeyDown(e)}\r\n                      />\r\n                      <label htmlFor=\"searchBox\">{translations.flyoutSearchBoxFloatingLabel}</label>\r\n                      <button\r\n                        onClick={() => this.startSearch()}\r\n                        class=\"nav-link start-search-button\"\r\n                      >\r\n                        <span class=\"visually-hidden\">{translations.searchSubmit}</span>\r\n                        <SvgIcon name=\"pi-search\" />\r\n                      </button>\r\n                    </div>\r\n                    {showPortalRecommendations && (\r\n                      <h2 class=\"bold\">{search.searchRecommendations.title}</h2>\r\n                    )}\r\n                    <ul\r\n                      class=\"suggestions no-list\"\r\n                      onMouseLeave={() => this.handleMouseLeaveSuggestions()}\r\n                    >\r\n                      {showPortalRecommendations &&\r\n                        search.searchRecommendations.links.map(recommendation => (\r\n                          <li key={recommendation.href}>\r\n                            <a\r\n                              class=\"nav-link search-recommendation\"\r\n                              href={new URL(recommendation.href, 'https://post.ch').href}\r\n                              data-suggestion-text={recommendation.label}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <span\r\n                                class=\"search-recommendation__icon\"\r\n                                innerHTML={recommendation.inlineSvg}\r\n                              ></span>\r\n                              <span>{recommendation.label}</span>\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {this.parcelSuggestion && this.parcelSuggestion.ok && (\r\n                        <li>\r\n                          <a\r\n                            class=\"nav-link parcel-suggestion\"\r\n                            href={this.parcelSuggestion.url}\r\n                            data-suggestion-text={this.searchBox?.value}\r\n                            onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                          >\r\n                            <SvgIcon name=\"pi-letter-parcel\" />\r\n                            <span class=\"bold\">{this.parcelSuggestion?.sending?.id}:&nbsp;</span>\r\n                            <span>\r\n                              {this.parcelSuggestion?.sending?.product},{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.zipcode}{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.city},{' '}\r\n                              {this.parcelSuggestion?.sending?.state}\r\n                            </span>\r\n                          </a>\r\n                        </li>\r\n                      )}\r\n                      {!showPortalRecommendations &&\r\n                        this.coveoSuggestions &&\r\n                        this.coveoSuggestions.map(suggestion => (\r\n                          <li key={suggestion.objectId}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={suggestion.redirectUrl}\r\n                              data-suggestion-text={suggestion.expression}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-search\" />\r\n                              <HighlightedText text={suggestion.highlighted} />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {!showPortalRecommendations &&\r\n                        this.placeSuggestions &&\r\n                        this.placeSuggestions.map(suggestion => (\r\n                          <li key={suggestion.id}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={getPlacesUrl(suggestion)}\r\n                              data-suggestion-text={suggestion.name}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-place\" />\r\n                              <HighlightedText\r\n                                text={highlightPlacesString(\r\n                                  this.searchBox?.value?.trim(),\r\n                                  suggestion.name,\r\n                                )}\r\n                              />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </If>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}
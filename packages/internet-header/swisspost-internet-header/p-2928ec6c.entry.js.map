{"version":3,"names":["getTrackAndTraceApiUrl","id","lang","state","currentLanguage","encodeURIComponent","getTrackAndTraceRedirectUrl","query","packageTrackingRedirectUrl","replace","isParcel","async","searchConfig","parcelInfo","getParcelInfo","ok","redirectPattern","trackingNrPattern","RegExp","test","trackAndTraceReqest","fetch","trackAndTraceResult","json","Object","assign","error","console","warn","message","timestamp","Date","toDateString","getParcelSuggestion","url","getSearchRedirectUrl","isTrackTraceId","getSearchPageUrl","_a","localizedConfig","header","search","undefined","searchPageUrl","searchParam","equalizeArrays","arrayA","arrayB","maxLength","coveoSliced","slice","Math","max","length","coveo","environment","prod","organisation","token","int01","int02","dev01","dev02","devs1","getCoveoSuggestions","_b","config","searchHubName","searchPipelineName","coveoCompletions","coveoResponse","method","headers","Authorization","coveoJSON","completions","map","completion","redirectUrl","expression","gisAPIUrl","placesUrl","pois","hardNormalize","str","toLowerCase","normalize","typesCache","convertTypes","typesResponse","typesJSON","poi","foundType","types","find","type","tag","filter","join","queryPlaces","limit","excludeTypes","geocoderUrl","geocodeResponse","geocodeJSON","Error","info","locations","location","includes","highlightPlacesString","place","reference","q","indexOfQuery","indexOf","substring","getPlacesUrl","name","HighlightedText","props","highlightClass","highlightedString","text","h","innerHTML","postSearchCss","PostSearch","connectedCallback","this","throttledResize","throttle","handleResize","window","addEventListener","passive","disconnectedCallback","removeEventListener","clearAllBodyScrollLocks","componentWillUpdate","searchFlyout","searchDropdownOpen","classList","remove","elementHasTransition","userPrefersReducedMotion","Promise","resolve","event","propertyName","componentDidUpdate","getBoundingClientRect","add","searchBox","focus","preventScroll","force","dropdownToggled","emit","open","element","host","coveoSuggestions","placeSuggestions","value","setFocus","setBodyScroll","shadowRoot","toggleButton","querySelector","innerWidth","disableBodyScroll","enableBodyScroll","trim","trackAndTraceInfo","all","parcelSuggestion","deselectSuggestion","handleKeyDown","selectedSuggestion","key","selectedHref","getAttribute","href","startSearch","suggestions","querySelectorAll","parentElement","nextElementSibling","firstElementChild","_d","_c","previousElementSibling","suggestedText","dataset","suggestionText","handleMouseEnterSuggestion","target","handleMouseLeaveSuggestions","render","translations","showPortalRecommendations","searchRecommendations","links","Host","SvgSprite","class","onClick","e","toggleDropdown","searchToggleExpanded","searchToggle","SvgIcon","If","condition","ref","placeholder","flyoutSearchBoxFloatingLabel","autocomplete","el","onInput","handleSearchInput","onKeyDown","htmlFor","searchSubmit","title","onMouseLeave","recommendation","URL","label","onMouseEnter","inlineSvg","_f","_e","sending","_h","_g","product","_k","_j","recipient","zipcode","_m","_l","city","_p","_o","suggestion","objectId","highlighted"],"sources":["./src/services/search/parcel.service.ts","./src/services/search/search.service.ts","./src/services/search/coveo.settings.ts","./src/services/search/coveo.service.ts","./src/services/search/places.settings.ts","./src/services/search/search-utilities.ts","./src/services/search/places.service.ts","./src/utils/highlighted.component.tsx","./src/components/post-search/post-search.scss?tag=post-search&encapsulation=shadow","./src/components/post-search/post-search.tsx"],"sourcesContent":["import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\n\r\n// https://www.post.ch/api/trackandtrace?id=99.00.306600.01004883\r\n\r\n// Track and trace URL\r\nexport const getTrackAndTraceApiUrl = (id: string) => {\r\n  const lang = state.currentLanguage;\r\n  return `https://www.post.ch/${lang}/api/trackandtrace?id=${encodeURIComponent(id)}`;\r\n};\r\n\r\n// Get the redire\r\nexport const getTrackAndTraceRedirectUrl = (\r\n  query: string,\r\n  { packageTrackingRedirectUrl }: ISearchConfig,\r\n) => {\r\n  return packageTrackingRedirectUrl.replace('{trackingNumber}', encodeURIComponent(query));\r\n};\r\n\r\n/**\r\n * Check whether a query is a tracking id\r\n *\r\n * @param query User query\r\n * @returns Boolean\r\n */\r\nexport const isParcel = async (query: string, searchConfig: ISearchConfig): Promise<boolean> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok;\r\n};\r\n\r\n/**\r\n * Try to get parcel info from a query that is possibly a tracking id.\r\n * This is mainly used to check if a search should redirect to track&trace instead of the regular search.\r\n *\r\n * @param query User query that is possibly a tracking number\r\n * @returns Track and trace info\r\n */\r\nexport const getParcelInfo = async (\r\n  query: string,\r\n  { redirectPattern }: ISearchConfig,\r\n): Promise<TrackAndTraceInfo> => {\r\n  const trackingNrPattern = new RegExp(redirectPattern);\r\n\r\n  if (trackingNrPattern.test(query)) {\r\n    try {\r\n      const trackAndTraceReqest = await fetch(getTrackAndTraceApiUrl(query));\r\n      const trackAndTraceResult = await trackAndTraceReqest.json();\r\n      return { ...trackAndTraceResult, ok: trackAndTraceResult.ok === 'true' };\r\n    } catch (error) {\r\n      console.warn(`Could not check track and trace API due to error: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  return { ok: false, timestamp: new Date().toDateString() };\r\n};\r\n\r\n/**\r\n * Get parcel info if query is a parcel or null\r\n *\r\n * @param query Parcel id\r\n * @returns Parcel info and a redirect url or null if not a parcel\r\n */\r\nexport const getParcelSuggestion = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<(TrackAndTraceInfo & { url: string }) | null> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok\r\n    ? { ...parcelInfo, url: getTrackAndTraceRedirectUrl(query, searchConfig) }\r\n    : null;\r\n};\r\n","import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { getTrackAndTraceRedirectUrl, isParcel } from './parcel.service';\r\n\r\n/**\r\n * Construct a search page url from a query\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getSearchRedirectUrl = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<string | undefined> => {\r\n  const isTrackTraceId = await isParcel(query, searchConfig);\r\n  return isTrackTraceId\r\n    ? getTrackAndTraceRedirectUrl(query, searchConfig)\r\n    : getSearchPageUrl(query);\r\n};\r\n\r\n/**\r\n * Stitch toghether the search page URL\r\n *\r\n * @param query Search term\r\n * @returns Search page URL\r\n */\r\nexport const getSearchPageUrl = (query: string): string | undefined => {\r\n  if (state.localizedConfig?.header.search === undefined) {\r\n    return;\r\n  }\r\n  const { searchPageUrl } = state.localizedConfig.header.search;\r\n  const searchParam = `#q=${encodeURIComponent(query)}`;\r\n  return `${searchPageUrl}${searchParam}&t=AllTab`;\r\n};\r\n\r\n/**\r\n * Equalize the length of two arrays while filling up empty slots up to max. length\r\n *\r\n * @param arrayA First array\r\n * @param arrayB Second array\r\n * @param maxLength Max. length of result array\r\n * @returns Array with two resulting arrays\r\n */\r\nexport const equalizeArrays = <A, B>(arrayA: A[], arrayB: B[], maxLength = 8): [A[], B[]] => {\r\n  const coveoSliced = arrayA.slice(0, Math.max(maxLength / 2, maxLength - arrayB.length));\r\n  return [coveoSliced, arrayB.slice(0, maxLength - coveoSliced.length)];\r\n};\r\n","import { CoveoOptions } from '../../models/coveo.model';\r\n\r\n// Coveo constants\r\nexport const coveo: CoveoOptions = {\r\n  url: 'https://platform-eu.cloud.coveo.com/rest/search/v2/querySuggest',\r\n  environment: {\r\n    prod: {\r\n      organisation: 'postchagprod6ef4sbet',\r\n      token: 'xx5b629890-23b9-4fbe-b601-0e8719186969',\r\n    },\r\n    int01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    int02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    devs1: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    test: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n  },\r\n};\r\n","import { state } from '../../data/store';\r\nimport { CoveoCompletion, CoveoResponse } from '../../models/coveo.model';\r\nimport { coveo } from './coveo.settings';\r\nimport { getSearchPageUrl } from './search.service';\r\n\r\n/**\r\n * Get suggestions from coveo\r\n * https://docs.coveo.com/en/1459/build-a-search-ui/get-query-suggestions#context-object\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getCoveoSuggestions = async (query: string): Promise<CoveoCompletion[]> => {\r\n  if (state.localizedConfig?.header?.search === undefined) return [];\r\n  const config = state.localizedConfig.header.search;\r\n  const { token, organisation } = coveo.environment[state.environment];\r\n  const url = `${coveo.url}?q=${query}&locale=${state.currentLanguage}&searchHub=${config.searchHubName}&pipeline=${config.searchPipelineName}&organizationId=${organisation}`;\r\n  let coveoCompletions: CoveoCompletion[] | undefined;\r\n\r\n  try {\r\n    const coveoResponse = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    const coveoJSON = (await coveoResponse.json()) as CoveoResponse;\r\n    coveoCompletions = coveoJSON.completions.map(completion => ({\r\n      ...completion,\r\n      redirectUrl: getSearchPageUrl(completion.expression),\r\n    }));\r\n  } catch (error) {\r\n    console.error(\r\n      'Connection to coveo failed. Did you add \"*.coveo.com\" to your connect-src content security policy and tried turning off your adblocker?',\r\n    );\r\n  }\r\n\r\n  return coveoCompletions === undefined ? [] : coveoCompletions;\r\n};\r\n","// Implement some TOPOS logic into the header search\r\nexport const gisAPIUrl = 'https://places.post.ch/StandortSuche/StaoCacheService';\r\nexport const placesUrl = 'https://places.post.ch';\r\nexport const pois = [\r\n  '001PST',\r\n  '001MP24',\r\n  '001AG-PICK',\r\n  '001PFFIL',\r\n  '001PFST',\r\n  '001BZ',\r\n  '001LZB',\r\n  '001PZ',\r\n  '001LZP',\r\n  '001AL',\r\n];\r\n","/**\r\n * Transform to lowercase, extract accents to separate unicode chars,\r\n * replace all accent unicode chars so only standard latin chars remain\r\n * https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript/37511463#37511463\r\n *\r\n * @param str Input string\r\n * @returns\r\n */\r\nexport const hardNormalize = (str: string): string =>\r\n  str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '');\r\n","import { state } from '../../data/store';\r\nimport { GeocodeLocation, GeocodeResponse, ServiceTypesResponse } from '../../models/geocode.model';\r\nimport { gisAPIUrl, pois, placesUrl } from './places.settings';\r\nimport { hardNormalize } from './search-utilities';\r\n\r\n// Never load types twice\r\nlet typesCache: string | null = null;\r\n\r\n/**\r\n * Convert Post POI ids to stao cache ids\r\n * @returns\r\n */\r\nconst convertTypes = async () => {\r\n  if (typesCache === null) {\r\n    try {\r\n      const typesResponse = await fetch(`${gisAPIUrl}/Types?lang=${state.currentLanguage}`);\r\n      const typesJSON = (await typesResponse.json()) as ServiceTypesResponse;\r\n      typesCache = encodeURIComponent(\r\n        pois\r\n          .map(poi => {\r\n            const foundType = typesJSON.types.find(type => type.id === poi);\r\n            return foundType?.tag;\r\n          })\r\n          .filter(poi => poi !== undefined)\r\n          .join(','),\r\n      );\r\n    } catch (error) {\r\n      console.error(\r\n        'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  return typesCache;\r\n};\r\n\r\n/**\r\n * Query the Gis API for locations and localities (pois)\r\n *\r\n * @param query User input string\r\n * @returns\r\n */\r\nexport const queryPlaces = async (query: string): Promise<GeocodeLocation[]> => {\r\n  if (query.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const limit = 8;\r\n  const excludeTypes = ['address', 'locality', 'region'];\r\n  const types = await convertTypes();\r\n  const geocoderUrl = `${gisAPIUrl}/Geocode?query=${encodeURIComponent(query)}&lang=${\r\n    state.currentLanguage\r\n  }&pois=${types}&limit=33`;\r\n\r\n  try {\r\n    const geocodeResponse = await fetch(geocoderUrl);\r\n    const geocodeJSON = (await geocodeResponse.json()) as GeocodeResponse;\r\n    if (!geocodeJSON.ok) {\r\n      throw new Error(geocodeJSON.info);\r\n    }\r\n    return geocodeJSON.locations\r\n      .filter(location => !excludeTypes.includes(location.type))\r\n      .slice(0, limit);\r\n  } catch (error) {\r\n    console.error(\r\n      'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n    );\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Try to highlight place suggestions\r\n * Limitation: accented chars are not handled by this basic function\r\n *\r\n * @param query Search term\r\n * @param place Name of the suggested place\r\n * @returns\r\n */\r\nexport const highlightPlacesString = (query: string | undefined, place: string) => {\r\n  if (query === undefined) return place;\r\n\r\n  // Strip accents from the string\r\n  const reference = hardNormalize(place);\r\n  const q = hardNormalize(query);\r\n  const indexOfQuery = reference.indexOf(q);\r\n\r\n  if (indexOfQuery < 0) {\r\n    return place;\r\n  }\r\n\r\n  return `${place.substring(0, indexOfQuery)}{${place.substring(\r\n    indexOfQuery,\r\n    indexOfQuery + query.length,\r\n  )}}${place.substring(indexOfQuery + query.length, place.length)}`;\r\n};\r\n\r\n/**\r\n * Get the deeplink to any location found via geocoder\r\n *\r\n * @param location A location from the Gis API Geocode endpoint\r\n * @returns\r\n */\r\nexport const getPlacesUrl = (location: GeocodeLocation): string => {\r\n  let url: string;\r\n\r\n  if (location.id) {\r\n    url = `${placesUrl}/${state.currentLanguage}/${location.id}/detail`;\r\n  } else {\r\n    url = `${placesUrl}?preselecttext=${encodeURIComponent(location.name)}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n","import { h } from '@stencil/core';\r\n\r\nexport const HighlightedText = (props: { text: string; highlightClass?: string }) => {\r\n  const highlightClass = props.highlightClass ?? 'bold';\r\n  const highlightedString = props.text\r\n    .replace(/{/g, `<span class=${highlightClass}>`)\r\n    .replace(/}/g, '</span>')\r\n    .replace(/[\\[\\]]/g, '');\r\n  return <span innerHTML={highlightedString}></span>;\r\n};\r\n","@use \"@swisspost/design-system-styles/variables/color\";\r\n@use \"@swisspost/design-system-styles/components/forms\";\r\n@use \"@swisspost/design-system-styles/components/floating-label\";\r\n@use \"@swisspost/design-system-styles/components/grid\";\r\n@use \"../../utils/utils.scss\";\r\n@use \"../../utils/mixins.scss\";\r\n\r\n:host {\r\n  display: block;\r\n}\r\n\r\n.search,\r\n:host {\r\n  height: 100%;\r\n}\r\n\r\n.search-button {\r\n  @extend %nav-link;\r\n\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  padding-right: calc(1rem - 1px);\r\n  padding-left: calc(1rem - 1px);\r\n\r\n  @include mixins.min(lg) {\r\n    padding: 0 calc(1.125rem - 1px);\r\n  }\r\n\r\n  @include mixins.min(xl) {\r\n    padding: 0 calc(1.5rem - 1px);\r\n  }\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n\r\n  .visually-hidden {\r\n    @include mixins.between(rg, lg) {\r\n      @include mixins.reset-visually-hidden();\r\n\r\n      font-weight: 300;\r\n      margin-right: 0.5rem;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n\r\n.flyout {\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  background: white;\r\n  overflow: auto;\r\n  overscroll-behavior: contain;\r\n  padding-top: 3.25rem;\r\n  padding-bottom: 3.25rem;\r\n  z-index: -1;\r\n  transform: translateY(-100%);\r\n  transition: transform 0.35s, box-shadow 0.35s;\r\n\r\n  @media (prefers-reduced-motion: reduce) {\r\n    transition: none;\r\n  }\r\n\r\n  @include mixins.min(lg) {\r\n    max-height: calc(100vh - var(--header-height) - var(--meta-header-height) - 1px);\r\n    box-shadow: 0 0 1px 0 rgb(0 0 0 / 40%);\r\n\r\n    &.open {\r\n      box-shadow: 0 0 8px 0 rgb(0 0 0 / 40%);\r\n    }\r\n  }\r\n\r\n  @include mixins.max(lg) {\r\n    height: calc(100vh - var(--header-height) - 1px);\r\n  }\r\n\r\n  &.open {\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.start-search-button {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  height: 100%;\r\n  padding-right: 1rem;\r\n  padding-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n}\r\n\r\n.suggestions {\r\n  margin: 1.5rem 0;\r\n\r\n  a {\r\n    padding: 0.75rem 1rem;\r\n\r\n    &:hover,\r\n    &:focus,\r\n    &.selected {\r\n      background: color.$gray-background;\r\n    }\r\n\r\n    &.parcel-suggestion {\r\n      flex-wrap: wrap;\r\n    }\r\n  }\r\n}\r\n\r\n.search-recommendation__icon {\r\n  height: 1.5em;\r\n  width: 1.5em;\r\n}\r\n","import { Component, Host, h, State, Event, EventEmitter, Method, Element } from '@stencil/core';\r\nimport { throttle } from 'throttle-debounce';\r\nimport { disableBodyScroll, enableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock';\r\nimport { state } from '../../data/store';\r\nimport { CoveoCompletion } from '../../models/coveo.model';\r\nimport { GeocodeLocation } from '../../models/geocode.model';\r\nimport {\r\n  DropdownElement,\r\n  DropdownEvent,\r\n  HasDropdown,\r\n  IsFocusable,\r\n} from '../../models/header.model';\r\nimport { getSearchRedirectUrl, equalizeArrays } from '../../services/search/search.service';\r\nimport { getCoveoSuggestions } from '../../services/search/coveo.service';\r\nimport {\r\n  getPlacesUrl,\r\n  highlightPlacesString,\r\n  queryPlaces,\r\n} from '../../services/search/places.service';\r\nimport { userPrefersReducedMotion, elementHasTransition } from '../../services/ui.service';\r\nimport { HighlightedText } from '../../utils/highlighted.component';\r\nimport { SvgSprite } from '../../utils/svg-sprite.component';\r\nimport { SvgIcon } from '../../utils/svg-icon.component';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\nimport { getParcelSuggestion } from '../../services/search/parcel.service';\r\nimport { If } from '../../utils/if.component';\r\n\r\n@Component({\r\n  tag: 'post-search',\r\n  styleUrl: 'post-search.scss',\r\n  shadow: true,\r\n})\r\nexport class PostSearch implements HasDropdown, IsFocusable {\r\n  @State() searchDropdownOpen = false;\r\n  @State() coveoSuggestions: CoveoCompletion[] = [];\r\n  @State() placeSuggestions: GeocodeLocation[] = [];\r\n  @State() parcelSuggestion: (TrackAndTraceInfo & { url: string }) | null = null;\r\n  @Event() dropdownToggled: EventEmitter<DropdownEvent>;\r\n  @Element() host: DropdownElement;\r\n  private searchBox?: HTMLInputElement;\r\n  private searchFlyout: HTMLElement | undefined;\r\n  private throttledResize: throttle<() => void>;\r\n\r\n  connectedCallback() {\r\n    this.throttledResize = throttle(300, () => this.handleResize());\r\n    window.addEventListener('resize', this.throttledResize, { passive: true });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('resize', this.throttledResize);\r\n    clearAllBodyScrollLocks();\r\n  }\r\n\r\n  componentWillUpdate() {\r\n    // Check if search flyout got set to close\r\n    if (this.searchFlyout && !this.searchDropdownOpen) {\r\n      this.searchFlyout.classList.remove('open');\r\n\r\n      // Check if element has transition applied and whether user prefers to see animations or not\r\n      if (elementHasTransition(this.searchFlyout, 'transform') && !userPrefersReducedMotion()) {\r\n        // Wait for CSS transition 'transform' to end before continuing\r\n        return new Promise<boolean>(resolve => {\r\n          if (this.searchFlyout === undefined) {\r\n            return resolve(true);\r\n          }\r\n\r\n          this.searchFlyout.addEventListener('transitionend', event => {\r\n            if (event.propertyName === 'transform') {\r\n              resolve(true);\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // Search flyout got set to open\r\n    if (this.searchFlyout && this.searchDropdownOpen) {\r\n      // Force browser to redraw/refresh DOM before adding 'open' class\r\n      this.searchFlyout.getBoundingClientRect();\r\n      this.searchFlyout.classList.add('open');\r\n    }\r\n\r\n    // Focus on the searchBox whenever the dropdown is opened\r\n    if (this.searchDropdownOpen && this.searchBox) {\r\n      this.searchBox.focus({ preventScroll: true });\r\n    }\r\n  }\r\n\r\n  public async toggleDropdown(event?: Event): Promise<boolean>;\r\n  public async toggleDropdown(force?: boolean): Promise<boolean>;\r\n\r\n  /**\r\n   * Toggle the dropdown and optionally force an open/closed state\r\n   * @param force Boolean to force open/closed state\r\n   * @returns Boolean indicating open state of the component\r\n   */\r\n  @Method()\r\n  async toggleDropdown(force?: unknown) {\r\n    this.searchDropdownOpen =\r\n      force === undefined || typeof force !== 'boolean' ? !this.searchDropdownOpen : force;\r\n    this.dropdownToggled.emit({ open: this.searchDropdownOpen, element: this.host });\r\n\r\n    if (!this.searchDropdownOpen) {\r\n      // Reset suggestions when dropdown closes\r\n      this.coveoSuggestions = [];\r\n      this.placeSuggestions = [];\r\n      if (this.searchBox) this.searchBox.value = '';\r\n      this.setFocus();\r\n    } else {\r\n      // Get basic suggestions when dropdown opens\r\n      try {\r\n        this.coveoSuggestions = await getCoveoSuggestions('');\r\n      } catch {}\r\n    }\r\n\r\n    this.setBodyScroll();\r\n\r\n    return this.searchDropdownOpen;\r\n  }\r\n\r\n  /**\r\n   * Sets the focus on the search button\r\n   */\r\n  @Method()\r\n  public async setFocus() {\r\n    const shadowRoot = this.host.shadowRoot;\r\n    if (shadowRoot === null) {\r\n      return;\r\n    }\r\n    const toggleButton = shadowRoot.querySelector<HTMLElement>('.search-button');\r\n    if (toggleButton) {\r\n      toggleButton.focus();\r\n    }\r\n  }\r\n\r\n  private handleResize() {\r\n    // Only enable/disable body scroll on resize if the search dropdown is open, otherwise this could lead to side effects in other controls\r\n    if (this.searchDropdownOpen) {\r\n      this.setBodyScroll();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable or re-enable body scrolling, depending on whether search dropdown is open or closed in mobile view (width < 1024px)\r\n   */\r\n  private setBodyScroll() {\r\n    if (this.searchDropdownOpen && window.innerWidth < 1024) {\r\n      disableBodyScroll(this.searchFlyout);\r\n    } else {\r\n      enableBodyScroll(this.searchFlyout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch suggestions from all available sources\r\n   */\r\n  private async handleSearchInput() {\r\n    if (this.searchBox === undefined || state.localizedConfig?.header.search === undefined) {\r\n      return;\r\n    }\r\n    const query = this.searchBox.value.trim();\r\n\r\n    const [placeSuggestions, coveoSuggestions, trackAndTraceInfo] = await Promise.all([\r\n      queryPlaces(query),\r\n      getCoveoSuggestions(query),\r\n      getParcelSuggestion(query, state.localizedConfig.header.search),\r\n    ]);\r\n\r\n    // Parcel suggestion is more important than any other\r\n    if (trackAndTraceInfo) {\r\n      this.parcelSuggestion = trackAndTraceInfo;\r\n      this.placeSuggestions = [];\r\n      this.coveoSuggestions = [];\r\n    } else {\r\n      [this.coveoSuggestions, this.placeSuggestions] = equalizeArrays(\r\n        coveoSuggestions,\r\n        placeSuggestions,\r\n        8,\r\n      );\r\n    }\r\n\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Start search on enter\r\n   * @param event\r\n   */\r\n  private handleKeyDown(event: KeyboardEvent) {\r\n    if (this.searchFlyout === undefined) {\r\n      return;\r\n    }\r\n\r\n    let selectedSuggestion = this.searchFlyout.querySelector<HTMLElement>(\r\n      '.suggestions > li > a.selected',\r\n    );\r\n\r\n    switch (event.key.toLowerCase()) {\r\n      case 'enter':\r\n        if (selectedSuggestion) {\r\n          const selectedHref = selectedSuggestion.getAttribute('href');\r\n          if (selectedHref !== null) {\r\n            window.location.href = selectedHref;\r\n          }\r\n        } else {\r\n          this.startSearch();\r\n        }\r\n\r\n        break;\r\n      case 'arrowdown':\r\n      case 'arrowup':\r\n        const suggestions = this.searchFlyout.querySelectorAll('.suggestions > li > a');\r\n\r\n        this.deselectSuggestion();\r\n\r\n        if (event.key.toLowerCase() === 'arrowdown') {\r\n          if (selectedSuggestion?.parentElement?.nextElementSibling?.firstElementChild) {\r\n            // Select next suggestion if there's any, otherwise none will be selected\r\n            selectedSuggestion.parentElement.nextElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select first suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[0].classList.add('selected');\r\n            }\r\n          }\r\n        } else if (event.key.toLowerCase() === 'arrowup') {\r\n          if (selectedSuggestion?.parentElement?.previousElementSibling?.firstElementChild) {\r\n            // Select previous suggestion if there's any, otherwise none will be selected\r\n\r\n            selectedSuggestion.parentElement.previousElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select last suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[suggestions.length - 1].classList.add('selected');\r\n            }\r\n          }\r\n        }\r\n\r\n        // Get the newly selected suggestion\r\n        selectedSuggestion = this.searchFlyout.querySelector('.suggestions > li > a.selected');\r\n        const suggestedText = selectedSuggestion?.dataset.suggestionText;\r\n\r\n        // Update search box value with selected suggestion text\r\n        if (suggestedText !== undefined && this.searchBox) {\r\n          this.searchBox.value = suggestedText;\r\n        }\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseEnterSuggestion(event: MouseEvent) {\r\n    this.deselectSuggestion();\r\n\r\n    // Set hovered suggestion element as selected\r\n    (event.target as HTMLElement).classList.add('selected');\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseLeaveSuggestions() {\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Deselect any previously selected suggestion\r\n   */\r\n  private deselectSuggestion() {\r\n    if (this.searchFlyout === undefined) return;\r\n\r\n    const selectedSuggestion = this.searchFlyout.querySelector('.suggestions .selected');\r\n\r\n    if (selectedSuggestion) {\r\n      selectedSuggestion.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redirect to the post search page\r\n   */\r\n  private async startSearch() {\r\n    if (this.searchBox && state.localizedConfig?.header.search) {\r\n      const redirectUrl = await getSearchRedirectUrl(\r\n        this.searchBox.value.trim(),\r\n        state.localizedConfig.header.search,\r\n      );\r\n      if (!redirectUrl) return;\r\n      window.location.href = redirectUrl;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (state.localizedConfig?.header === undefined) {\r\n      return;\r\n    }\r\n    const { translations, search } = state.localizedConfig.header;\r\n    const showPortalRecommendations =\r\n      this.searchBox?.value === '' && search.searchRecommendations?.links.length > 0;\r\n\r\n    return (\r\n      <Host>\r\n        <SvgSprite />\r\n        <div class=\"search\">\r\n          <button\r\n            id=\"post-internet-header-search-button\"\r\n            class=\"search-button\"\r\n            type=\"button\"\r\n            aria-expanded={`${this.searchDropdownOpen}`}\r\n            onClick={e => this.toggleDropdown(e)}\r\n          >\r\n            <span class=\"visually-hidden\">\r\n              {this.searchDropdownOpen\r\n                ? translations.searchToggleExpanded\r\n                : translations.searchToggle}\r\n            </span>\r\n            <SvgIcon name={this.searchDropdownOpen ? 'pi-close' : 'pi-search'} />\r\n          </button>\r\n          <If condition={this.searchDropdownOpen}>\r\n            <div class=\"flyout\" ref={e => (this.searchFlyout = e)}>\r\n              <div class=\"container box\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-xs-12 col-md-10 col-lg-8\">\r\n                    <div class=\"form-group form-floating\">\r\n                      <input\r\n                        type=\"text\"\r\n                        id=\"searchBox\"\r\n                        class=\"form-control form-control-lg\"\r\n                        placeholder={translations.flyoutSearchBoxFloatingLabel}\r\n                        autocomplete=\"off\"\r\n                        ref={el => (this.searchBox = el)}\r\n                        onInput={() => this.handleSearchInput()}\r\n                        onKeyDown={e => this.handleKeyDown(e)}\r\n                      />\r\n                      <label htmlFor=\"searchBox\">{translations.flyoutSearchBoxFloatingLabel}</label>\r\n                      <button\r\n                        onClick={() => this.startSearch()}\r\n                        class=\"nav-link start-search-button\"\r\n                      >\r\n                        <span class=\"visually-hidden\">{translations.searchSubmit}</span>\r\n                        <SvgIcon name=\"pi-search\" />\r\n                      </button>\r\n                    </div>\r\n                    {showPortalRecommendations && (\r\n                      <h2 class=\"bold\">{search.searchRecommendations.title}</h2>\r\n                    )}\r\n                    <ul\r\n                      class=\"suggestions no-list\"\r\n                      onMouseLeave={() => this.handleMouseLeaveSuggestions()}\r\n                    >\r\n                      {showPortalRecommendations &&\r\n                        search.searchRecommendations.links.map(recommendation => (\r\n                          <li key={recommendation.href}>\r\n                            <a\r\n                              class=\"nav-link search-recommendation\"\r\n                              href={new URL(recommendation.href, 'https://post.ch').href}\r\n                              data-suggestion-text={recommendation.label}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <span\r\n                                class=\"search-recommendation__icon\"\r\n                                innerHTML={recommendation.inlineSvg}\r\n                              ></span>\r\n                              <span>{recommendation.label}</span>\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {this.parcelSuggestion && this.parcelSuggestion.ok && (\r\n                        <li>\r\n                          <a\r\n                            class=\"nav-link parcel-suggestion\"\r\n                            href={this.parcelSuggestion.url}\r\n                            data-suggestion-text={this.searchBox?.value}\r\n                            onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                          >\r\n                            <SvgIcon name=\"pi-letter-parcel\" />\r\n                            <span class=\"bold\">{this.parcelSuggestion?.sending?.id}:&nbsp;</span>\r\n                            <span>\r\n                              {this.parcelSuggestion?.sending?.product},{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.zipcode}{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.city},{' '}\r\n                              {this.parcelSuggestion?.sending?.state}\r\n                            </span>\r\n                          </a>\r\n                        </li>\r\n                      )}\r\n                      {!showPortalRecommendations &&\r\n                        this.coveoSuggestions &&\r\n                        this.coveoSuggestions.map(suggestion => (\r\n                          <li key={suggestion.objectId}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={suggestion.redirectUrl}\r\n                              data-suggestion-text={suggestion.expression}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-search\" />\r\n                              <HighlightedText text={suggestion.highlighted} />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {!showPortalRecommendations &&\r\n                        this.placeSuggestions &&\r\n                        this.placeSuggestions.map(suggestion => (\r\n                          <li key={suggestion.id}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={getPlacesUrl(suggestion)}\r\n                              data-suggestion-text={suggestion.name}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-place\" />\r\n                              <HighlightedText\r\n                                text={highlightPlacesString(\r\n                                  this.searchBox?.value?.trim(),\r\n                                  suggestion.name,\r\n                                )}\r\n                              />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </If>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}
{"version":3,"names":["markActiveRoute","config","activeRouteProp","compareUrl","resetOverrideConfig","hasActivePortalRoute","resetActiveStateToPortalConfig","URL","window","location","href","document","origin","error","console","warn","concat","scoreList","compileScoreList","length","winnerPair","main","isActiveOverride","sub","filter","nav","isActive","map","Object","assign","flyout","linkList","link","hadAnyActiveLink","forEach","mainNav","score","compareRoutes","url","Infinity","push","_a","linklist","sort","a","b","baseUrl","matchMode","pathname","baseSegments","__spreadArray","split","x","compareSegments","getSimilarityScore","Math","min","i","request","osFlyoutCache","getLocalizedConfig","_d","projectId","environment","language","cookieKey","localStorageKey","localizedCustomConfig","osFlyoutOverrides","fetchConfig","_e","sent","lang","getUserLang","keys","undefined","Error","localizedConfig","header","navMain","mergeOsFlyoutOverrides","setMainNavigationIds","_b","persistLanguageChoice","id","JSON","parse","stringify","mainNavText","text","mainNavTitle","title","mainNavFlyout","col","index","overrides","slice","__awaiter","_this","isValidProjectId","generateConfigUrl","fetch","res","json","error_1","message","parsedEnvironment","toLowerCase","isProd","host","encodeURIComponent","toString","test","getLocalizedCustomConfig","customConfig","navMainEntities","navMainEntity","uniqueId","postInternetHeaderCss","PostInternetHeader","exports","class_1","hostRef","this","lastScrollTop","scrollY","documentElement","scrollTop","lastWindowWidth","innerWidth","handleClickOutsideBound","handleClickOutside","bind","project","prototype","getCurrentLanguage","state","currentLanguage","connectedCallback","throttledScroll","throttle","handleScrollEvent","debouncedResize","debounce","handleResize","addEventListener","passive","disconnectedCallback","removeEventListener","dispose","componentWillLoad","languageSwitchOverrides","languageCookieKey","languageLocalStorageKey","activeRoute","error_2","componentDidLoad","requestAnimationFrame","headerLoaded","emit","classList","add","handleLanguageChange","newValue","handleAvailableLanguagesChage","handleOsFlyoutOverrides","handleActiveRouteChange","handleCustomConfigChange","handleSearchChange","search","handleLoginChange","login","handleMetaChange","meta","handleLanguageChangeEvent","event","detail","activeDropdownElement","composedPath","includes","toggleDropdown","handleKeyUp","key","activeFlyout","st","stickyness","toggle","isMainNavOpen","handleDropdownToggled","open","element","setTimeout","setActiveFlyout","handleFlyoutToggled","toggleMobileDropdown","tagName","render","renderMetaNavigation","navMeta","isHomeLink","renderLogin","_c","isLoginWidgetHidden","loginWidgetOptions","renderLanguageSwitch","navLang","h","Host","class","packageJson","version","onKeyup","e","fullWidth","SvgSprite","If","condition","skiplinks","orientation","mode","onDropdownToggled","onClick","mobileMenu","SvgIcon","name","onFlyoutToggled","ref","el"],"sources":["src/services/route.service.ts","src/services/config.service.ts","src/components/post-internet-header/post-internet-header.scss?tag=swisspost-internet-header&encapsulation=shadow","src/components/post-internet-header/post-internet-header.tsx"],"sourcesContent":["import { ActiveRouteProp } from '../models/general.model';\r\nimport { NavMainEntity, MainNavScoreList } from '../models/header.model';\r\n\r\n/**\r\n * Activate the current route based on the config and the match mode\r\n * @param config Main Navigation Config\r\n * @param activeRouteProp Match mode\r\n * @returns Modified Main Navigation Config\r\n */\r\nexport const markActiveRoute = (\r\n  config: NavMainEntity[],\r\n  activeRouteProp: ActiveRouteProp,\r\n): NavMainEntity[] => {\r\n  // Don't highlight any route\r\n  if (activeRouteProp === false) {\r\n    return config;\r\n  }\r\n\r\n  // Set compare URL and check if activeRouteProp is valid\r\n  let compareUrl: URL;\r\n  config = resetOverrideConfig(config);\r\n\r\n  if (activeRouteProp === 'auto' || activeRouteProp === 'exact') {\r\n    // Check if an active route is already configured, set override to that and return\r\n    if (hasActivePortalRoute(config)) {\r\n      return resetActiveStateToPortalConfig(config);\r\n    }\r\n\r\n    compareUrl = new URL(window.location.href);\r\n  } else {\r\n    try {\r\n      compareUrl = new URL(activeRouteProp, document.location.origin);\r\n    } catch (error) {\r\n      console.warn(\r\n        `Active Route: ${activeRouteProp} is not a valid URL. Navigation highlighting has been disabled.`,\r\n      );\r\n      return config;\r\n    }\r\n  }\r\n\r\n  const scoreList = compileScoreList(config, compareUrl, activeRouteProp);\r\n\r\n  if (scoreList.length === 0) {\r\n    // No match found or already active links defined\r\n    return config;\r\n  }\r\n\r\n  const winnerPair = scoreList[0];\r\n  winnerPair.main.isActiveOverride = true;\r\n  if (winnerPair.sub) winnerPair.sub.isActiveOverride = true;\r\n\r\n  return config;\r\n};\r\n\r\n/**\r\n * Check if the portal config set any active route\r\n * @param config Main navigation config\r\n * @returns True if portal set any route as active\r\n */\r\nexport const hasActivePortalRoute = (config: NavMainEntity[]): boolean => {\r\n  return config.filter(nav => nav.isActive).length > 0;\r\n};\r\n\r\nexport const resetActiveStateToPortalConfig = (config: NavMainEntity[]): NavMainEntity[] => {\r\n  return config.map(nav => ({\r\n    ...nav,\r\n    isActiveOverride: nav.isActive,\r\n    flyout: nav.flyout.map(flyout => ({\r\n      ...flyout,\r\n      linkList: flyout.linkList.map(link => ({ ...link, isActiveOverride: link.isActive })),\r\n    })),\r\n  }));\r\n};\r\n\r\nconst resetOverrideConfig = (config: NavMainEntity[]): NavMainEntity[] => {\r\n  return config.map(nav => ({\r\n    ...nav,\r\n    isActiveOverride: false,\r\n    flyout: nav.flyout.map(flyout => ({\r\n      ...flyout,\r\n      linkList: flyout.linkList.map(link => ({ ...link, isActiveOverride: false })),\r\n    })),\r\n  }));\r\n};\r\n\r\n/**\r\n * Compile a list of scores based on the map mode, sorted in descending order\r\n * @param config Main Nav Config\r\n * @param compareUrl Current Browser URL or a custom URL\r\n * @param activeRouteProp Match mode\r\n * @returns A list of scored URLs if any matched\r\n */\r\nexport const compileScoreList = (\r\n  config: NavMainEntity[],\r\n  compareUrl: URL,\r\n  activeRouteProp: ActiveRouteProp,\r\n): MainNavScoreList => {\r\n  // Flag to check if the Portal set any active links or if there are any exact matches\r\n  let hadAnyActiveLink = false;\r\n  const scoreList: MainNavScoreList = [];\r\n\r\n  config.forEach(mainNav => {\r\n    if (hadAnyActiveLink || !mainNav) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const score = compareRoutes(\r\n        compareUrl,\r\n        new URL(mainNav.url),\r\n        activeRouteProp as 'auto' | 'exact',\r\n      );\r\n      if (score > 0) {\r\n        if (score === Infinity) hadAnyActiveLink = true;\r\n        scoreList.push({ main: mainNav, score });\r\n      }\r\n    } catch {\r\n      // Not a valid url, continue\r\n    }\r\n\r\n    // Loop through flyout links 2nd level\r\n    if (mainNav.flyout.length) {\r\n      mainNav.flyout.forEach(flyout => {\r\n        if (flyout.linkList) {\r\n          flyout.linkList.forEach(linklist => {\r\n            // Don't override if any link is already active\r\n            if (linklist.isActive && (activeRouteProp === 'auto' || activeRouteProp === 'exact')) {\r\n              hadAnyActiveLink = true;\r\n              return;\r\n            }\r\n\r\n            try {\r\n              const url = new URL(linklist.url);\r\n              const score = compareRoutes(compareUrl, url, activeRouteProp as 'auto' | 'exact');\r\n              if (score > 0) {\r\n                if (score === Infinity) hadAnyActiveLink = true;\r\n\r\n                // Push score\r\n                scoreList.push({\r\n                  main: mainNav,\r\n                  sub: linklist,\r\n                  score,\r\n                });\r\n              }\r\n            } catch {\r\n              // Not a valid URL, continue\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  return scoreList.sort((a, b) => b.score - a.score);\r\n};\r\n\r\n/**\r\n * Compare two URLs for similarity based on a match mode\r\n * @param baseUrl Browser URL\r\n * @param compareUrl Navigatgion URL\r\n * @param matchMode exact or auto matching\r\n * @returns Score\r\n */\r\nexport const compareRoutes = (\r\n  baseUrl: URL,\r\n  compareUrl: URL,\r\n  matchMode?: 'auto' | 'exact',\r\n): number => {\r\n  // One url is not defined or they don't share the same orign\r\n  if (!baseUrl || !compareUrl || baseUrl.origin !== compareUrl.origin) {\r\n    return 0;\r\n  }\r\n\r\n  // Exact match, origin and pathname are the same\r\n  if (baseUrl.pathname === compareUrl.pathname) {\r\n    return Infinity;\r\n  }\r\n\r\n  // The basepath is longer than the comparison, a match is impossible\r\n  if (baseUrl.pathname.length < compareUrl.pathname.length) {\r\n    return 0;\r\n  }\r\n\r\n  if (matchMode === 'auto') {\r\n    const baseSegments = [baseUrl.origin, ...baseUrl.pathname.split('/').filter(x => !!x)];\r\n    const compareSegments = [compareUrl.origin, ...compareUrl.pathname.split('/').filter(x => !!x)];\r\n\r\n    const score = getSimilarityScore(baseSegments, compareSegments);\r\n\r\n    // If only some segments match, but not the whole smaller array, it's not a match\r\n    return Math.min(baseSegments.length, compareSegments.length) === score ? score : 0;\r\n  }\r\n\r\n  return 0;\r\n};\r\n\r\n/**\r\n * Check how many items in an array match\r\n * @param a Base array\r\n * @param b Compare array\r\n * @returns Score\r\n */\r\nexport const getSimilarityScore = (a: string[], b: string[]): number => {\r\n  if (!a?.length || !b?.length) {\r\n    return 0;\r\n  }\r\n\r\n  let i = 0;\r\n  for (; i < Math.min(a.length, b.length); i++) {\r\n    if (a[i] !== b[i]) {\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  return i;\r\n};\r\n","import {\r\n  Environment,\r\n  IPortalConfig,\r\n  ILocalizedConfig,\r\n  ICustomConfig,\r\n  ILocalizedCustomConfig,\r\n  LocalizedConfigParameters,\r\n} from '../models/general.model';\r\nimport { NavMainEntity } from '../models/header.model';\r\nimport { getUserLang, persistLanguageChoice } from './language.service';\r\nimport { uniqueId } from '../utils/utils';\r\nimport { markActiveRoute } from './route.service';\r\n\r\n// Prevent double requests\r\nlet request: Promise<IPortalConfig> | null = null;\r\n\r\n// Cache the original os flyout to use it for updates\r\nlet osFlyoutCache: NavMainEntity | null = null;\r\n\r\n/**\r\n * Get a localized config object\r\n *\r\n * @param projectId String identifying the project\r\n * @param language [optional] Preferred language\r\n * @returns Localized config object\r\n */\r\nexport const getLocalizedConfig = async ({\r\n  projectId,\r\n  environment,\r\n  language,\r\n  cookieKey,\r\n  localStorageKey,\r\n  activeRouteProp,\r\n  localizedCustomConfig,\r\n  osFlyoutOverrides,\r\n}: LocalizedConfigParameters): Promise<ILocalizedConfig> => {\r\n  if (!request) {\r\n    request = fetchConfig(projectId, environment);\r\n  }\r\n\r\n  const config = await request;\r\n  const lang = getUserLang(Object.keys(config), language, localStorageKey, cookieKey);\r\n\r\n  if (lang === undefined) {\r\n    throw new Error('Internet Header: unable to determine current language');\r\n  }\r\n\r\n  // Clone config for more predictable state updates\r\n  let localizedConfig: ILocalizedConfig = { ...config[lang] };\r\n\r\n  // Merge custom config with portal config\r\n  if (localizedCustomConfig) {\r\n    const header = localizedCustomConfig?.header?.navMain\r\n      ? {\r\n          ...localizedConfig.header,\r\n          navMain: [...localizedConfig.header.navMain, ...localizedCustomConfig.header.navMain],\r\n        }\r\n      : localizedConfig.header;\r\n    localizedConfig = {\r\n      ...localizedConfig,\r\n      header,\r\n    };\r\n  }\r\n\r\n  // Add entries to flyout_os\r\n  if (osFlyoutOverrides)\r\n    localizedConfig.header.navMain = mergeOsFlyoutOverrides(localizedConfig, osFlyoutOverrides);\r\n\r\n  // Mark active route\r\n  if (activeRouteProp)\r\n    localizedConfig.header.navMain = markActiveRoute(\r\n      localizedConfig.header.navMain,\r\n      activeRouteProp,\r\n    );\r\n\r\n  setMainNavigationIds(localizedConfig?.header?.navMain);\r\n\r\n  // Set the new language choice\r\n  persistLanguageChoice(lang, cookieKey, localStorageKey);\r\n\r\n  return localizedConfig;\r\n};\r\n\r\n/**\r\n * Merge portal config with custom os flyout overrides\r\n * @param config Localized config\r\n * @param osFlyoutOverrides Overrides for the flyout\r\n * @returns Merged localized config\r\n */\r\nexport const mergeOsFlyoutOverrides = (\r\n  config: ILocalizedConfig,\r\n  osFlyoutOverrides: NavMainEntity,\r\n): NavMainEntity[] => {\r\n  if (!osFlyoutOverrides) return config.header.navMain;\r\n\r\n  return config.header.navMain.map(mainNav => {\r\n    if (mainNav.id !== 'flyout_os') return mainNav;\r\n\r\n    if (osFlyoutCache === null) {\r\n      osFlyoutCache = JSON.parse(JSON.stringify(mainNav)) as NavMainEntity;\r\n    }\r\n\r\n    const mainNavText = osFlyoutOverrides.text ?? osFlyoutCache.text;\r\n    const mainNavTitle = osFlyoutOverrides.title ?? osFlyoutCache.title;\r\n\r\n    if (\r\n      !osFlyoutCache.flyout ||\r\n      osFlyoutCache.flyout.length === 0 ||\r\n      !osFlyoutOverrides.flyout ||\r\n      osFlyoutOverrides.flyout.length === 0\r\n    )\r\n      return {\r\n        ...mainNav,\r\n        title: mainNavTitle,\r\n        text: mainNavText,\r\n      };\r\n\r\n    // Add entries for os flyout columns without overriding existing config\r\n    const mainNavFlyout = [\r\n      ...osFlyoutCache.flyout.map((col, index) => {\r\n        const overrides = osFlyoutOverrides.flyout[index];\r\n        const title = overrides.title ?? col.title;\r\n\r\n        const linkList = overrides.linkList ? osFlyoutOverrides.flyout[index].linkList : [];\r\n\r\n        return {\r\n          title,\r\n          linkList: [...col.linkList, ...linkList],\r\n        };\r\n      }),\r\n      ...osFlyoutOverrides.flyout.slice(osFlyoutCache.flyout.length),\r\n    ];\r\n\r\n    return {\r\n      ...mainNav,\r\n      text: mainNavText,\r\n      title: mainNavTitle,\r\n      flyout: mainNavFlyout,\r\n    } as NavMainEntity;\r\n  });\r\n};\r\n\r\n/**\r\n * Fetch the general config based on project id\r\n *\r\n * @returns Promise for Post Portal general config\r\n */\r\nexport const fetchConfig = async (\r\n  projectId: string,\r\n  environment: Environment,\r\n): Promise<IPortalConfig> => {\r\n  // Check if project id is sanitized\r\n  if (!isValidProjectId(projectId)) {\r\n    throw new Error(`Internet Header: invalid project id \"${projectId}\"`);\r\n  }\r\n\r\n  if (projectId === 'test') {\r\n    environment = 'int01';\r\n  }\r\n\r\n  let url = generateConfigUrl(projectId, environment);\r\n\r\n  // Get the config if cache is invalid\r\n  try {\r\n    const res = await fetch(url);\r\n    return (await res.json()) as IPortalConfig;\r\n  } catch (error) {\r\n    throw new Error(`Internet Header: fetching config failed. ${error.message}`);\r\n  }\r\n};\r\n\r\n/**\r\n * Generate an URL with all necessary query params to get the configuration.\r\n * Project id \"test\" will return a test configuration\r\n * @param projectId string\r\n * @param environment int01, int02 or prod\r\n * @returns URL pointing to the project config\r\n */\r\nexport const generateConfigUrl = (projectId: string, environment: Environment): string => {\r\n  if (projectId === 'test') return 'assets/config/test-configuration.json';\r\n\r\n  const parsedEnvironment = environment.toLowerCase();\r\n  const isProd = parsedEnvironment === 'prod';\r\n  const host = `https://${isProd ? 'www' : 'int'}.post.ch`;\r\n  try {\r\n    // Use URL to validate the generated URL\r\n    return new URL(\r\n      `${host}/api/headerjs/Json?serviceid=${encodeURIComponent(projectId)}${\r\n        !isProd ? '&environment=' + parsedEnvironment : ''\r\n      }`,\r\n    ).toString();\r\n  } catch (error) {\r\n    throw new Error(`Internet Header: Config URL is invalid.`);\r\n  }\r\n};\r\n\r\n/**\r\n * Check if project id contains only URL safe characters\r\n *\r\n * @param projectId Project Id string\r\n * @returns The valid project id\r\n */\r\nexport const isValidProjectId = (projectId: string): boolean => {\r\n  return projectId !== '' && projectId.length > 0 && /^[a-zA-Z][\\w-]*[a-zA-Z0-9]$/.test(projectId);\r\n};\r\n\r\n/**\r\n * Get the localized config object from a custom config\r\n *\r\n * @param config String or json object of the custom config\r\n * @param language Specific language\r\n * @returns Localized custom config object\r\n */\r\nexport const getLocalizedCustomConfig = (\r\n  config: string | ICustomConfig,\r\n  language: string,\r\n): ILocalizedCustomConfig | undefined => {\r\n  let customConfig: ICustomConfig;\r\n  try {\r\n    customConfig = typeof config === 'string' ? JSON.parse(config) : config;\r\n  } catch (error) {\r\n    throw new Error(\r\n      `Internet Header: Custom config is invalid. Make sure your custom config contains valid JSON syntax and matches the definition. `,\r\n    );\r\n  }\r\n  let localizedCustomConfig: ILocalizedCustomConfig | undefined = customConfig[language];\r\n  if (localizedCustomConfig?.header?.navMain)\r\n    setMainNavigationIds(localizedCustomConfig.header.navMain);\r\n  return localizedCustomConfig;\r\n};\r\n\r\n/**\r\n * Check if mobile header styles are applied or not\r\n * @returns True if browser is smaller than 1024px\r\n */\r\nexport const isMobile = () => window.innerWidth < 1024;\r\n\r\n/**\r\n * Set unique ID's on main navigation entities but conserve flyout_os to be able to\r\n * identify the online-service flyout, which can be configured by osFlyoutOverrides\r\n */\r\nexport const setMainNavigationIds = (navMainEntities: NavMainEntity[]): void => {\r\n  navMainEntities.forEach(navMainEntity => {\r\n    navMainEntity.id = navMainEntity.id === 'flyout_os' ? navMainEntity.id : uniqueId('main-nav-');\r\n  });\r\n};\r\n","@use '@swisspost/design-system-styles/variables/color';\r\n@use '../../utils/utils.scss';\r\n@use '../../utils/mixins.scss';\r\n\r\n:host {\r\n  display: block;\r\n  position: relative;\r\n  font-size: 1rem;\r\n  font-weight: 300;\r\n  z-index: var(--header-z-index, 10);\r\n\r\n  --header-height: 3.5rem; // 56px\r\n  --meta-header-height: 0px; // Not visible on mobile\r\n  --language-dropdown-margin-top: 0px;\r\n\r\n  @include mixins.min(lg) {\r\n    --meta-header-height: 3rem; // 48px\r\n    --header-height: 4rem; // 64px\r\n  }\r\n\r\n  @include mixins.min(xl) {\r\n    --header-height: 4.5rem; // 72px\r\n  }\r\n}\r\n\r\n// Set height to 0 if meta is never visible\r\n:host([meta='false']) {\r\n  --meta-header-height: 0px;\r\n  // Compensation for header border-bottom, when language dropdown is displayed within main navigation controls\r\n  --language-dropdown-margin-top: 1px;\r\n}\r\n\r\n// Support different kinds of stickyness modes\r\n// Works only in combination with setting header heights dynamically\r\n@supports (position: sticky) {\r\n  // If stickyness is none, simply apply no styles, all others are sticky\r\n  :host(:not(.stickyness-none)) {\r\n    position: sticky;\r\n  }\r\n\r\n  // Everything is always sticky\r\n  :host(.stickyness-full) {\r\n    top: 0;\r\n  }\r\n\r\n  // Only main nav is sticky\r\n  :host(.stickyness-main) {\r\n    top: calc(var(--meta-header-height, 0px) * -1);\r\n  }\r\n\r\n  // Hide everything\r\n  :host(.stickyness-minimal) {\r\n    top: calc((var(--header-height, 0px) + var(--meta-header-height, 0px)) * -1);\r\n    transition: top 200ms ease-in;\r\n  }\r\n\r\n  // Show main when scrolling up or any of the menus are open\r\n  :host(.stickyness-minimal.scrolling-up),\r\n  :host(.stickyness-minimal.dropdown-open) {\r\n    top: calc(var(--meta-header-height, 0px) * -1);\r\n    transition: top 200ms ease-out;\r\n  }\r\n}\r\n\r\n.post-internet-header {\r\n  border-bottom: 1px solid color.$gray-10;\r\n  background-color: white;\r\n}\r\n\r\n.main-navigation-container {\r\n  display: flex;\r\n\r\n  & > .main-navigation-controls {\r\n    flex: 0 0 auto;\r\n  }\r\n}\r\n\r\n.main-navigation {\r\n  display: flex;\r\n}\r\n\r\n.sub-navigation-container {\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  display: flex;\r\n  background: white;\r\n  visibility: hidden;\r\n}\r\n\r\n.main-navigation-item:hover .sub-navigation-container {\r\n  visibility: visible;\r\n}\r\n\r\n.main-navigation-controls {\r\n  display: flex;\r\n  margin-left: auto;\r\n\r\n  @include mixins.max(lg) {\r\n    font-weight: 400;\r\n  }\r\n\r\n  @include mixins.min(lg) {\r\n    font-size: 1.0625rem;\r\n  }\r\n\r\n  & > * {\r\n    border-left: 1px solid color.$gray-10;\r\n  }\r\n}\r\n\r\n.menu-button {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 calc(1rem - 1px);\r\n  font-weight: 300;\r\n  cursor: pointer;\r\n  border-left: 1px solid color.$gray-10;\r\n  order: 1; /* Display on the far right because of tab order */\r\n\r\n  @include mixins.min(lg) {\r\n    display: none;\r\n  }\r\n\r\n  .visually-hidden {\r\n    @include mixins.between(rg, lg) {\r\n      @include mixins.reset-visually-hidden();\r\n\r\n      margin-right: 0.5rem;\r\n    }\r\n  }\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n}\r\n\r\n.full-width {\r\n  .wide-container {\r\n    max-width: none;\r\n  }\r\n}\r\n","import {\r\n  Component,\r\n  Host,\r\n  Element,\r\n  h,\r\n  State,\r\n  Prop,\r\n  Watch,\r\n  Listen,\r\n  EventEmitter,\r\n  Event,\r\n  Method,\r\n} from '@stencil/core';\r\nimport { debounce, throttle } from 'throttle-debounce';\r\nimport {\r\n  getLocalizedConfig,\r\n  getLocalizedCustomConfig,\r\n  isValidProjectId,\r\n} from '../../services/config.service';\r\nimport { state, dispose } from '../../data/store';\r\nimport { DropdownElement, DropdownEvent, NavMainEntity } from '../../models/header.model';\r\nimport { SvgSprite } from '../../utils/svg-sprite.component';\r\nimport { SvgIcon } from '../../utils/svg-icon.component';\r\nimport { StickynessOptions } from '../../models/implementor.model';\r\nimport { ActiveRouteProp, Environment, ICustomConfig } from '../../models/general.model';\r\nimport { IAvailableLanguage } from '../../models/language.model';\r\nimport { If } from '../../utils/if.component';\r\nimport packageJson from '../../../package.json';\r\n\r\n@Component({\r\n  tag: 'swisspost-internet-header',\r\n  styleUrl: 'post-internet-header.scss',\r\n  shadow: true,\r\n})\r\nexport class PostInternetHeader {\r\n  /**\r\n   * Your project id, previously passed as query string parameter serviceId.\r\n   */\r\n  @Prop() project: string;\r\n\r\n  /**\r\n   * Sticky behaviour of the header.\r\n   */\r\n  @Prop() stickyness: StickynessOptions = 'minimal';\r\n\r\n  /**\r\n   * Initial language to be used. Overrides automatic language detection.\r\n   */\r\n  @Prop() language?: string;\r\n\r\n  /**\r\n   * Toggle the meta navigation.\r\n   */\r\n  @Prop() meta: boolean = true;\r\n\r\n  /**\r\n   * Toggle the login link (when logged out) or the user widget (when logged in).\r\n   */\r\n  @Prop() login: boolean = true;\r\n\r\n  /**\r\n   * Toggle the search button.\r\n   */\r\n  @Prop() search: boolean = true;\r\n\r\n  /**\r\n   * Toggle skiplinks. They help keyboard users to quickly jump to important sections of the page.\r\n   */\r\n  @Prop() skiplinks: boolean = true;\r\n\r\n  /**\r\n   * DEPRECATED!: Define a proxy URL for the config fetch request. Will be removed in the next major version\r\n   */\r\n  @Prop() configProxy?: string;\r\n\r\n  /**\r\n   * Target environment. Choose 'int01' for local testing.\r\n   */\r\n  @Prop() environment: Environment = 'prod';\r\n\r\n  /**\r\n   * Override the language switch links with custom URLs. Helpful when your application contains sub-pages and you\r\n   * would like to stay on subpages when the user changes language.\r\n   */\r\n  @Prop() languageSwitchOverrides?: string | IAvailableLanguage[];\r\n\r\n  /**\r\n   * Customize the header config loaded from the post portal.\r\n   */\r\n  @Prop() customConfig?: string | ICustomConfig;\r\n\r\n  /**\r\n   * The header uses this cookie to set the language. Disables automatic language detection.\r\n   */\r\n  @Prop() languageCookieKey?: string;\r\n\r\n  /**\r\n   * The header uses this local storage key to set the language. Disables automatic language selection.\r\n   */\r\n  @Prop() languageLocalStorageKey?: string = 'swisspost-internet-header-language';\r\n\r\n  /**\r\n   * Set the currently activated route. If there is a link matching this URL in the header, it will be highlighted.\r\n   * Will also highlight partly matching URLs. When set to auto, will use current location.href for comparison.\r\n   */\r\n  @Prop() activeRoute?: 'auto' | false | string = 'auto';\r\n\r\n  /**\r\n   * Online Services only: Add custom links to the special online service navigation entry\r\n   */\r\n  @Prop() osFlyoutOverrides?: string | NavMainEntity;\r\n\r\n  /**\r\n   * Displays the header at full width for full-screen applications\r\n   */\r\n  @Prop() fullWidth?: boolean = false;\r\n\r\n  /**\r\n   * Fires when the header has been rendered to the page.\r\n   */\r\n  @Event() headerLoaded: EventEmitter<void>;\r\n\r\n  @State() activeFlyout: string | null = null;\r\n  @State() activeDropdownElement: DropdownElement | null = null;\r\n  @Element() host: HTMLElement;\r\n\r\n  /**\r\n   * Get the currently set language as a two letter string (\"de\", \"fr\" \"it\" or \"en\")\r\n   * @returns string\r\n   */\r\n  @Method()\r\n  async getCurrentLanguage(): Promise<'de' | 'fr' | 'it' | 'en' | string> {\r\n    return state.currentLanguage ?? 'de';\r\n  }\r\n\r\n  private mainNav?: HTMLPostMainNavigationElement;\r\n  private lastScrollTop = window.scrollY || document.documentElement.scrollTop;\r\n  private throttledScroll: throttle<() => void>;\r\n  private debouncedResize: debounce<() => void>;\r\n  private lastWindowWidth: number = window.innerWidth;\r\n\r\n  constructor() {\r\n    if (this.project === undefined || this.project === '' || !isValidProjectId(this.project)) {\r\n      throw new Error(\r\n        `Internet Header project key is \"${this.project}\". Please provide a valid project key.`,\r\n      );\r\n    }\r\n  }\r\n\r\n  connectedCallback() {\r\n    this.throttledScroll = throttle(300, () => this.handleScrollEvent());\r\n    this.debouncedResize = debounce(200, () => this.handleResize());\r\n    window.addEventListener('scroll', this.throttledScroll, { passive: true });\r\n    window.addEventListener('resize', this.debouncedResize, { passive: true });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('scroll', this.throttledScroll);\r\n    window.removeEventListener('resize', this.debouncedResize);\r\n\r\n    // Reset the store to its original state\r\n    dispose();\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    // Wait for the config to arrive, then render the header\r\n    try {\r\n      state.projectId = this.project;\r\n      state.environment = this.environment;\r\n      if (this.language !== undefined) state.currentLanguage = this.language;\r\n      state.languageSwitchOverrides =\r\n        typeof this.languageSwitchOverrides === 'string'\r\n          ? JSON.parse(this.languageSwitchOverrides)\r\n          : this.languageSwitchOverrides;\r\n      state.osFlyoutOverrides =\r\n        typeof this.osFlyoutOverrides === 'string'\r\n          ? JSON.parse(this.osFlyoutOverrides)\r\n          : this.osFlyoutOverrides;\r\n\r\n      if (this.customConfig !== undefined && state.currentLanguage !== null) {\r\n        state.localizedCustomConfig = getLocalizedCustomConfig(\r\n          this.customConfig,\r\n          state.currentLanguage,\r\n        );\r\n      }\r\n\r\n      state.localizedConfig = await getLocalizedConfig({\r\n        projectId: this.project,\r\n        environment: this.environment,\r\n        language: this.language,\r\n        cookieKey: this.languageCookieKey,\r\n        localStorageKey: this.languageLocalStorageKey,\r\n        activeRouteProp: this.activeRoute,\r\n        localizedCustomConfig: state.localizedCustomConfig,\r\n        osFlyoutOverrides: state.osFlyoutOverrides,\r\n      });\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    window.requestAnimationFrame(() => {\r\n      this.handleResize();\r\n      this.headerLoaded.emit();\r\n      this.host.classList.add('header-loaded');\r\n    });\r\n  }\r\n\r\n  @Watch('language')\r\n  async handleLanguageChange(newValue: string) {\r\n    state.currentLanguage = newValue;\r\n    state.localizedConfig = await getLocalizedConfig({\r\n      projectId: this.project,\r\n      environment: this.environment,\r\n      language: newValue,\r\n      cookieKey: this.languageCookieKey,\r\n      localStorageKey: this.languageLocalStorageKey,\r\n      activeRouteProp: this.activeRoute,\r\n      localizedCustomConfig: state.localizedCustomConfig,\r\n      osFlyoutOverrides: state.osFlyoutOverrides,\r\n    });\r\n    if (this.customConfig)\r\n      state.localizedCustomConfig = getLocalizedCustomConfig(this.customConfig, newValue);\r\n  }\r\n\r\n  @Watch('languageSwitchOverrides')\r\n  handleAvailableLanguagesChage(newValue: string | IAvailableLanguage[]) {\r\n    state.languageSwitchOverrides = typeof newValue === 'string' ? JSON.parse(newValue) : newValue;\r\n  }\r\n\r\n  @Watch('osFlyoutOverrides')\r\n  async handleOsFlyoutOverrides(newValue: string | NavMainEntity) {\r\n    state.osFlyoutOverrides = typeof newValue === 'string' ? JSON.parse(newValue) : newValue;\r\n    state.localizedConfig = await getLocalizedConfig({\r\n      projectId: this.project,\r\n      environment: this.environment,\r\n      language: this.language,\r\n      cookieKey: this.languageCookieKey,\r\n      localStorageKey: this.languageLocalStorageKey,\r\n      activeRouteProp: this.activeRoute,\r\n      localizedCustomConfig: state.localizedCustomConfig,\r\n      osFlyoutOverrides: state.osFlyoutOverrides,\r\n    });\r\n  }\r\n\r\n  @Watch('activeRoute')\r\n  async handleActiveRouteChange(newValue: string | ActiveRouteProp) {\r\n    state.localizedConfig = await getLocalizedConfig({\r\n      projectId: this.project,\r\n      environment: this.environment,\r\n      language: this.language,\r\n      cookieKey: this.languageCookieKey,\r\n      localStorageKey: this.languageLocalStorageKey,\r\n      activeRouteProp: newValue,\r\n      localizedCustomConfig: state.localizedCustomConfig,\r\n      osFlyoutOverrides: state.osFlyoutOverrides,\r\n    });\r\n  }\r\n\r\n  @Watch('customConfig')\r\n  async handleCustomConfigChange(newValue: string | ICustomConfig) {\r\n    if (this.language === undefined) return;\r\n    const localizedCustomConfig = getLocalizedCustomConfig(newValue, this.language);\r\n    state.localizedCustomConfig = localizedCustomConfig;\r\n    state.localizedConfig = await getLocalizedConfig({\r\n      projectId: this.project,\r\n      environment: this.environment,\r\n      language: this.language,\r\n      cookieKey: this.languageCookieKey,\r\n      localStorageKey: this.languageLocalStorageKey,\r\n      activeRouteProp: this.activeRoute,\r\n      localizedCustomConfig: localizedCustomConfig,\r\n      osFlyoutOverrides: state.osFlyoutOverrides,\r\n    });\r\n  }\r\n\r\n  @Watch('search')\r\n  handleSearchChange(newValue: boolean) {\r\n    state.search = newValue;\r\n  }\r\n\r\n  @Watch('login')\r\n  handleLoginChange(newValue: boolean) {\r\n    state.login = newValue;\r\n  }\r\n\r\n  @Watch('meta')\r\n  handleMetaChange(newValue: boolean) {\r\n    state.meta = newValue;\r\n  }\r\n\r\n  @Listen('languageChanged')\r\n  handleLanguageChangeEvent(event: CustomEvent<string>) {\r\n    this.handleLanguageChange(event.detail);\r\n  }\r\n\r\n  private handleClickOutsideBound = this.handleClickOutside.bind(this);\r\n\r\n  private handleClickOutside(event: Event) {\r\n    // Close active dropdown element on click outside of it\r\n    if (this.activeDropdownElement && !event.composedPath().includes(this.activeDropdownElement)) {\r\n      this.activeDropdownElement.toggleDropdown(false);\r\n    }\r\n  }\r\n\r\n  private handleKeyUp(event: KeyboardEvent) {\r\n    if (event.key === 'Escape') {\r\n      if (this.activeDropdownElement) {\r\n        this.activeDropdownElement.toggleDropdown(false);\r\n      }\r\n      if (this.activeFlyout !== null && this.mainNav) {\r\n        this.mainNav.toggleDropdown(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  private handleScrollEvent() {\r\n    // Credits: \"https://github.com/qeremy/so/blob/master/so.dom.js#L426\"\r\n    const st = window.scrollY || document.documentElement.scrollTop;\r\n\r\n    // Toggle class without re-rendering the component if stickyness is minimal\r\n    // the other stickyness modes do not need the class\r\n    if (this.stickyness === 'minimal') {\r\n      this.host.classList.toggle('scrolling-up', st <= this.lastScrollTop);\r\n    }\r\n\r\n    // For Mobile or negative scrolling\r\n    this.lastScrollTop = st <= 0 ? 0 : st;\r\n  }\r\n\r\n  private handleResize() {\r\n    // Close main navigation dropdown if size changed to bigger than 1024px (search dropdown will be kept open)\r\n    if (this.isMainNavOpen() && this.lastWindowWidth < 1024 && window.innerWidth >= 1024) {\r\n      this.activeDropdownElement?.toggleDropdown(false);\r\n    }\r\n\r\n    this.lastWindowWidth = window.innerWidth;\r\n  }\r\n\r\n  /**\r\n   * Close open dropdown menus if another is being opened\r\n   *\r\n   * @param event Dropdown toggled event\r\n   * @returns void\r\n   */\r\n  private handleDropdownToggled(event: CustomEvent<DropdownEvent>) {\r\n    if (!event.detail.open && this.activeDropdownElement !== event.detail.element) {\r\n      // Some dropdown got closed programmatically (possibly by this function). To prevent\r\n      // a circle or an outdated state, we'll not handle this event\r\n      return;\r\n    }\r\n\r\n    if (event.detail.open === true) {\r\n      if (this.activeDropdownElement) {\r\n        this.activeDropdownElement.toggleDropdown(false);\r\n      }\r\n\r\n      this.activeDropdownElement = event.detail.element;\r\n\r\n      if (window.innerWidth >= 1024) {\r\n        // Add event listener to close active dropdown element on click outsite of it\r\n        // Also adds 10ms delay in case of an external interaction:\r\n        //    Some button on the page calls toggleDropdown() -> dropdown opens\r\n        //    Click event bubbles to the window, this.handleClickOutsideBound closes dropdown again\r\n        window.setTimeout(() => {\r\n          window.addEventListener('click', this.handleClickOutsideBound);\r\n        }, 10);\r\n      }\r\n\r\n      if (this.activeFlyout !== null && this.mainNav) {\r\n        this.mainNav.setActiveFlyout(null);\r\n      }\r\n    } else {\r\n      this.activeDropdownElement = null;\r\n\r\n      // Remove event listener as it is not needed if no dropdown element is active\r\n      window.removeEventListener('click', this.handleClickOutsideBound);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Close open dropdowns if the flyout is being opened\r\n   * @param event Flyout toggle event\r\n   */\r\n  private handleFlyoutToggled(event: CustomEvent<string | null>) {\r\n    this.activeFlyout = event.detail;\r\n\r\n    if (this.activeDropdownElement && event.detail && !this.isMainNavOpen()) {\r\n      this.activeDropdownElement.toggleDropdown(false);\r\n    }\r\n  }\r\n\r\n  private toggleMobileDropdown() {\r\n    this.mainNav?.toggleDropdown();\r\n  }\r\n\r\n  private isMainNavOpen() {\r\n    return (\r\n      this.activeDropdownElement && this.activeDropdownElement.tagName === 'POST-MAIN-NAVIGATION'\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!state.localizedConfig?.header) {\r\n      console.error(new Error('Internet Header: Config cannot be loaded'));\r\n      return;\r\n    }\r\n\r\n    const config = state.localizedConfig;\r\n    const renderMetaNavigation =\r\n      this.meta &&\r\n      config.header.navMeta !== undefined &&\r\n      config.header.navMeta?.filter(meta => !meta.isHomeLink).length > 0;\r\n    const renderLogin =\r\n      (this.login ?? !config.header.isLoginWidgetHidden) && config.header.loginWidgetOptions;\r\n    const renderLanguageSwitch = config.header.navLang.length > 1;\r\n\r\n    return (\r\n      <Host\r\n        class={`stickyness-${this.stickyness} ${\r\n          this.activeDropdownElement || this.activeFlyout ? 'dropdown-open' : ''\r\n        }`}\r\n        data-version={packageJson.version}\r\n        onKeyup={(e: KeyboardEvent) => this.handleKeyUp(e)}\r\n      >\r\n        <header class={`post-internet-header${this.fullWidth ? ' full-width' : ''}`}>\r\n          <SvgSprite />\r\n          <If condition={this.skiplinks === true}>\r\n            <post-skiplinks></post-skiplinks>\r\n          </If>\r\n          <If condition={renderMetaNavigation === true}>\r\n            <post-meta-navigation\r\n              orientation=\"horizontal\"\r\n              class=\"hidden-lg\"\r\n              full-width={this.fullWidth}\r\n            >\r\n              <If condition={renderLanguageSwitch === true}>\r\n                <post-language-switch\r\n                  id=\"post-language-switch-desktop\"\r\n                  mode=\"dropdown\"\r\n                  onDropdownToggled={e => this.handleDropdownToggled(e)}\r\n                ></post-language-switch>\r\n              </If>\r\n            </post-meta-navigation>\r\n          </If>\r\n          <div class=\"main-navigation-container wide-container\">\r\n            <post-logo></post-logo>\r\n            <button class=\"menu-button nav-link\" onClick={() => this.toggleMobileDropdown()}>\r\n              <span class=\"menu-button-text visually-hidden\">{config.header.mobileMenu.text}</span>\r\n              <SvgIcon name={this.isMainNavOpen() ? 'pi-close' : 'pi-menu'}></SvgIcon>\r\n            </button>\r\n            <post-main-navigation\r\n              onDropdownToggled={e => this.handleDropdownToggled(e)}\r\n              onFlyoutToggled={e => this.handleFlyoutToggled(e)}\r\n              ref={el => (this.mainNav = el)}\r\n            >\r\n              <If condition={renderMetaNavigation === true}>\r\n                <post-meta-navigation orientation=\"vertical\">\r\n                  <If condition={renderLanguageSwitch === true}>\r\n                    <post-language-switch\r\n                      id=\"post-language-switch-mobile\"\r\n                      mode=\"list\"\r\n                    ></post-language-switch>\r\n                  </If>\r\n                </post-meta-navigation>\r\n              </If>\r\n            </post-main-navigation>\r\n            <div class=\"main-navigation-controls\">\r\n              <If condition={this.search !== false}>\r\n                <post-search onDropdownToggled={e => this.handleDropdownToggled(e)}></post-search>\r\n              </If>\r\n              <If condition={!!renderLogin}>\r\n                <post-klp-login-widget>\r\n                  <slot name=\"login-widget\"></slot>\r\n                </post-klp-login-widget>\r\n              </If>\r\n              <If condition={renderMetaNavigation === false && renderLanguageSwitch === true}>\r\n                <post-language-switch\r\n                  id=\"post-language-switch-no-meta\"\r\n                  onDropdownToggled={e => this.handleDropdownToggled(e)}\r\n                  mode=\"dropdown\"\r\n                ></post-language-switch>\r\n              </If>\r\n              <slot name=\"main\"></slot>\r\n            </div>\r\n          </div>\r\n        </header>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}
{"version":3,"names":["translations","de","fr","it","getUserLang","supportedLanguages","implementorPreferredLanguage","localStorageKey","cookieKey","length","undefined","url","URL","window","location","href","languagesSet","searchParams","get","pathname","split","find","segment","includes","localStorage","getItem","getCookie","document","documentElement","lang","getPreferredLanguageFromBrowser","state","currentLanguage","filter","language","Error","persistLanguageChoice","setItem","setCookie","name","_a","cookie","match","pop","key","value","encodeURIComponent","navigator","extractLanguage","indexOf","languages","l","substring","toLowerCase","translate","translationObject","_b","_c"],"sources":["./src/assets/i18n/translations.ts","./src/services/language.service.ts"],"sourcesContent":["export const translations = {\r\n  'Close overlay': {\r\n    de: 'Overlay Schliessen',\r\n    fr: 'Fermer la superposition',\r\n    it: 'Chiudi sovrapposizione',\r\n  },\r\n  'Current language is English': {\r\n    de: 'Die aktuelle Sprache ist Deutsch',\r\n    fr: 'La langue actuelle est le français',\r\n    it: \"La lingua corrente è l'italiano\",\r\n  },\r\n  'Change language': {\r\n    de: 'Sprache wechseln',\r\n    fr: 'Changer de langue',\r\n    it: 'Cambia lingua',\r\n  },\r\n  'Go to main content': {\r\n    de: 'Zum Hauptinhalt springen',\r\n    fr: 'Aller au contenu principal',\r\n    it: 'Vai al contenuto principale',\r\n  },\r\n  'Go to search': {\r\n    de: 'Zur Suche springen',\r\n    fr: 'Aller à la recherche',\r\n    it: 'Vai alla ricerca',\r\n  },\r\n  'Go to login': {\r\n    de: 'Zum Login springen',\r\n    fr: 'Aller au login',\r\n    it: 'Vai al login',\r\n  },\r\n  'Open menu': {\r\n    de: 'Menü öffnen',\r\n    fr: 'Ouvrir le menu',\r\n    it: 'Apri il menu',\r\n  },\r\n  'Navigate on post.ch': {\r\n    de: 'Navigieren auf post.ch',\r\n    fr: 'Naviguer sur post.ch',\r\n    it: 'Navigate su post.ch',\r\n  },\r\n};\r\n","import { translations } from '../assets/i18n/translations';\r\nimport { state } from '../data/store';\r\n\r\nexport const getUserLang = (\r\n  supportedLanguages: string[],\r\n  implementorPreferredLanguage?: string,\r\n  localStorageKey?: string,\r\n  cookieKey?: string,\r\n) => {\r\n  // If there are no supported languages, well...\r\n  if (supportedLanguages.length === 0) {\r\n    return undefined;\r\n  }\r\n\r\n  // If there is only one language in the config, use this\r\n  if (supportedLanguages.length === 1) {\r\n    return supportedLanguages[0];\r\n  }\r\n\r\n  const url = new URL(window.location.href);\r\n\r\n  /**\r\n   * Build array of possible language definitions in order of importance.\r\n   * At the end is a filter function that will weed out any undefined or null entries.\r\n   */\r\n  let languagesSet: Array<string> = [\r\n    // Check if implementor overrides lang config\r\n    implementorPreferredLanguage,\r\n\r\n    // Check query string param\r\n    url.searchParams.get('lang'),\r\n\r\n    // Check url pathname\r\n    url.pathname.split('/').find(segment => supportedLanguages.includes(segment)),\r\n\r\n    // Check local storage with the key provided\r\n    localStorageKey !== undefined ? window.localStorage.getItem(localStorageKey) : null,\r\n\r\n    // Check cookies\r\n    getCookie('language'),\r\n    getCookie('lang'),\r\n    cookieKey !== undefined ? getCookie(cookieKey) : null,\r\n\r\n    // Check document language\r\n    document.documentElement.lang,\r\n\r\n    // Check browser preferred language\r\n    getPreferredLanguageFromBrowser(supportedLanguages),\r\n\r\n    // Check the state\r\n    state.currentLanguage,\r\n  ].filter((lang): lang is string => !!lang);\r\n\r\n  // Check the set of languages to see if it matches\r\n  // any of the supported languages. Return the first\r\n  // supported language if there is none set\r\n  const lang =\r\n    languagesSet.find(language => supportedLanguages.includes(language)) || supportedLanguages[0];\r\n\r\n  if (!lang || lang.length !== 2) {\r\n    throw new Error(\r\n      `Current language could not be determined from settings or the language provided (${lang}) is not supported by the Header API.`,\r\n    );\r\n  }\r\n\r\n  return lang;\r\n};\r\n\r\n/**\r\n * Persist chosen language to local storage\r\n * @param lang Currently chose language, two char string\r\n */\r\nexport const persistLanguageChoice = (\r\n  lang: string,\r\n  cookieKey?: string,\r\n  localStorageKey?: string,\r\n) => {\r\n  if (localStorageKey !== undefined) {\r\n    window.localStorage.setItem(localStorageKey, lang);\r\n  }\r\n\r\n  if (cookieKey !== undefined) {\r\n    setCookie(cookieKey, lang);\r\n  }\r\n\r\n  state.currentLanguage = lang;\r\n};\r\n\r\n/**\r\n * Read a cookie by name\r\n * https://stackoverflow.com/questions/5639346/what-is-the-shortest-function-for-reading-a-cookie-by-name-in-javascript?rq=1\r\n * @param name Cookie name\r\n * @returns Cookie value or an empty string\r\n */\r\nexport const getCookie = (name: string) => {\r\n  return document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]+)')?.pop() || '';\r\n};\r\n\r\n/**\r\n * Write a new cookie\r\n * https://developer.mozilla.org/en-US/docs/Web/API/document/cookie#A_little_framework.3A_a_complete_cookies_reader.2Fwriter_with_full_unicode_support\r\n * @param key\r\n * @param value\r\n */\r\nexport const setCookie = (key: string, value: string) => {\r\n  document.cookie = `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\r\n};\r\n\r\nconst getPreferredLanguageFromBrowser = (supportedLanguages: string[]): string | null => {\r\n  // IE & Chrome\r\n  if (navigator.language) {\r\n    const lang = extractLanguage(navigator.language);\r\n    if (supportedLanguages.indexOf(lang) !== -1) {\r\n      return lang;\r\n    }\r\n  }\r\n\r\n  // Chrome supports a list of preferred languages: if the preferred is not supported, we go down the list.\r\n  if (navigator.languages) {\r\n    for (const l of navigator.languages) {\r\n      const lang = extractLanguage(l);\r\n      if (supportedLanguages.indexOf(lang) !== -1) {\r\n        return lang;\r\n      }\r\n    }\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst extractLanguage = (language: string): string => language.substring(0, 2).toLowerCase();\r\n\r\n/**\r\n * Simple translate function for general header UI strings\r\n *\r\n * @param key Translation key\r\n * @param lang Force a language\r\n * @param translationObject Optionally provide translations\r\n * @returns Translated string or the key\r\n */\r\nexport const translate = (key: string, lang?: string, translationObject = translations) =>\r\n  translationObject[key]?.[lang ?? state.currentLanguage ?? ''] ?? key;\r\n"],"mappings":"oCAAO,MAAMA,EAAe,CAC1B,gBAAiB,CACfC,GAAI,qBACJC,GAAI,0BACJC,GAAI,0BAEN,8BAA+B,CAC7BF,GAAI,mCACJC,GAAI,qCACJC,GAAI,mCAEN,kBAAmB,CACjBF,GAAI,mBACJC,GAAI,oBACJC,GAAI,iBAEN,qBAAsB,CACpBF,GAAI,2BACJC,GAAI,6BACJC,GAAI,+BAEN,eAAgB,CACdF,GAAI,qBACJC,GAAI,uBACJC,GAAI,oBAEN,cAAe,CACbF,GAAI,qBACJC,GAAI,iBACJC,GAAI,gBAEN,YAAa,CACXF,GAAI,cACJC,GAAI,iBACJC,GAAI,gBAEN,sBAAuB,CACrBF,GAAI,yBACJC,GAAI,uBACJC,GAAI,wB,MCpCKC,EAAc,CACzBC,EACAC,EACAC,EACAC,KAGA,GAAIH,EAAmBI,SAAW,EAAG,CACnC,OAAOC,S,CAIT,GAAIL,EAAmBI,SAAW,EAAG,CACnC,OAAOJ,EAAmB,E,CAG5B,MAAMM,EAAM,IAAIC,IAAIC,OAAOC,SAASC,MAMpC,IAAIC,EAA8B,CAEhCV,EAGAK,EAAIM,aAAaC,IAAI,QAGrBP,EAAIQ,SAASC,MAAM,KAAKC,MAAKC,GAAWjB,EAAmBkB,SAASD,KAGpEf,IAAoBG,UAAYG,OAAOW,aAAaC,QAAQlB,GAAmB,KAG/EmB,EAAU,YACVA,EAAU,QACVlB,IAAcE,UAAYgB,EAAUlB,GAAa,KAGjDmB,SAASC,gBAAgBC,KAGzBC,EAAgCzB,GAGhC0B,EAAMC,iBACNC,QAAQJ,KAA2BA,IAKrC,MAAMA,EACJb,EAAaK,MAAKa,GAAY7B,EAAmBkB,SAASW,MAAc7B,EAAmB,GAE7F,IAAKwB,GAAQA,EAAKpB,SAAW,EAAG,CAC9B,MAAM,IAAI0B,MACR,oFAAoFN,yC,CAIxF,OAAOA,CAAI,E,MAOAO,EAAwB,CACnCP,EACArB,EACAD,KAEA,GAAIA,IAAoBG,UAAW,CACjCG,OAAOW,aAAaa,QAAQ9B,EAAiBsB,E,CAG/C,GAAIrB,IAAcE,UAAW,CAC3B4B,EAAU9B,EAAWqB,E,CAGvBE,EAAMC,gBAAkBH,CAAI,EASvB,MAAMH,EAAaa,I,MACxB,QAAOC,EAAAb,SAASc,OAAOC,MAAM,YAAcH,EAAO,uBAAmB,MAAAC,SAAA,SAAAA,EAAEG,QAAS,EAAE,EAS7E,MAAML,EAAY,CAACM,EAAaC,KACrClB,SAASc,OAAS,GAAGK,mBAAmBF,MAAQE,mBAAmBD,IAAQ,EAG7E,MAAMf,EAAmCzB,IAEvC,GAAI0C,UAAUb,SAAU,CACtB,MAAML,EAAOmB,EAAgBD,UAAUb,UACvC,GAAI7B,EAAmB4C,QAAQpB,MAAW,EAAG,CAC3C,OAAOA,C,EAKX,GAAIkB,UAAUG,UAAW,CACvB,IAAK,MAAMC,KAAKJ,UAAUG,UAAW,CACnC,MAAMrB,EAAOmB,EAAgBG,GAC7B,GAAI9C,EAAmB4C,QAAQpB,MAAW,EAAG,CAC3C,OAAOA,C,GAKb,OAAO,IAAI,EAGb,MAAMmB,EAAmBd,GAA6BA,EAASkB,UAAU,EAAG,GAAGC,c,MAUlEC,EAAY,CAACV,EAAaf,EAAe0B,EAAoBvD,KAAY,IAAAwC,EAAAgB,EAAAC,EACpF,OAAAA,GAAAjB,EAAAe,EAAkBX,MAAI,MAAAJ,SAAA,SAAAA,GAAGgB,EAAA3B,IAAI,MAAJA,SAAI,EAAJA,EAAQE,EAAMC,mBAAe,MAAAwB,SAAA,EAAAA,EAAI,OAAG,MAAAC,SAAA,EAAAA,EAAIb,CAAG,S"}
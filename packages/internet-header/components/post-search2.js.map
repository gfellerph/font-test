{"file":"post-search2.js","mappings":"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","names":[],"sources":["./src/services/search/parcel.service.ts","./src/services/search/search.service.ts","./src/services/search/coveo.settings.ts","./src/services/search/coveo.service.ts","./src/services/search/places.settings.ts","./src/services/search/search-utilities.ts","./src/services/search/places.service.ts","./src/utils/highlighted.component.tsx","./src/utils/if.component.tsx","./src/components/post-search/post-search.scss?tag=post-search&encapsulation=shadow","./src/components/post-search/post-search.tsx"],"sourcesContent":["import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\n\r\n// https://www.post.ch/api/trackandtrace?id=99.00.306600.01004883\r\n\r\n// Track and trace URL\r\nexport const getTrackAndTraceApiUrl = (id: string) => {\r\n  const lang = state.currentLanguage;\r\n  return `https://www.post.ch/${lang}/api/trackandtrace?id=${encodeURIComponent(id)}`;\r\n};\r\n\r\n// Get the redire\r\nexport const getTrackAndTraceRedirectUrl = (\r\n  query: string,\r\n  { packageTrackingRedirectUrl }: ISearchConfig,\r\n) => {\r\n  return packageTrackingRedirectUrl.replace('{trackingNumber}', encodeURIComponent(query));\r\n};\r\n\r\n/**\r\n * Check whether a query is a tracking id\r\n *\r\n * @param query User query\r\n * @returns Boolean\r\n */\r\nexport const isParcel = async (query: string, searchConfig: ISearchConfig): Promise<boolean> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok;\r\n};\r\n\r\n/**\r\n * Try to get parcel info from a query that is possibly a tracking id.\r\n * This is mainly used to check if a search should redirect to track&trace instead of the regular search.\r\n *\r\n * @param query User query that is possibly a tracking number\r\n * @returns Track and trace info\r\n */\r\nexport const getParcelInfo = async (\r\n  query: string,\r\n  { redirectPattern }: ISearchConfig,\r\n): Promise<TrackAndTraceInfo> => {\r\n  const trackingNrPattern = new RegExp(redirectPattern);\r\n\r\n  if (trackingNrPattern.test(query)) {\r\n    try {\r\n      const trackAndTraceReqest = await fetch(getTrackAndTraceApiUrl(query));\r\n      const trackAndTraceResult = await trackAndTraceReqest.json();\r\n      return { ...trackAndTraceResult, ok: trackAndTraceResult.ok === 'true' };\r\n    } catch (error) {\r\n      console.warn(`Could not check track and trace API due to error: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  return { ok: false, timestamp: new Date().toDateString() };\r\n};\r\n\r\n/**\r\n * Get parcel info if query is a parcel or null\r\n *\r\n * @param query Parcel id\r\n * @returns Parcel info and a redirect url or null if not a parcel\r\n */\r\nexport const getParcelSuggestion = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<(TrackAndTraceInfo & { url: string }) | null> => {\r\n  const parcelInfo = await getParcelInfo(query, searchConfig);\r\n  return parcelInfo.ok\r\n    ? { ...parcelInfo, url: getTrackAndTraceRedirectUrl(query, searchConfig) }\r\n    : null;\r\n};\r\n","import { state } from '../../data/store';\r\nimport { ISearchConfig } from '../../models/header.model';\r\nimport { getTrackAndTraceRedirectUrl, isParcel } from './parcel.service';\r\n\r\n/**\r\n * Construct a search page url from a query\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getSearchRedirectUrl = async (\r\n  query: string,\r\n  searchConfig: ISearchConfig,\r\n): Promise<string | undefined> => {\r\n  const isTrackTraceId = await isParcel(query, searchConfig);\r\n  return isTrackTraceId\r\n    ? getTrackAndTraceRedirectUrl(query, searchConfig)\r\n    : getSearchPageUrl(query);\r\n};\r\n\r\n/**\r\n * Stitch toghether the search page URL\r\n *\r\n * @param query Search term\r\n * @returns Search page URL\r\n */\r\nexport const getSearchPageUrl = (query: string): string | undefined => {\r\n  if (state.localizedConfig?.header.search === undefined) {\r\n    return;\r\n  }\r\n  const { searchPageUrl } = state.localizedConfig.header.search;\r\n  const searchParam = `#q=${encodeURIComponent(query)}`;\r\n  return `${searchPageUrl}${searchParam}&t=AllTab`;\r\n};\r\n\r\n/**\r\n * Equalize the length of two arrays while filling up empty slots up to max. length\r\n *\r\n * @param arrayA First array\r\n * @param arrayB Second array\r\n * @param maxLength Max. length of result array\r\n * @returns Array with two resulting arrays\r\n */\r\nexport const equalizeArrays = <A, B>(arrayA: A[], arrayB: B[], maxLength = 8): [A[], B[]] => {\r\n  const coveoSliced = arrayA.slice(0, Math.max(maxLength / 2, maxLength - arrayB.length));\r\n  return [coveoSliced, arrayB.slice(0, maxLength - coveoSliced.length)];\r\n};\r\n","import { CoveoOptions } from '../../models/coveo.model';\r\n\r\n// Coveo constants\r\nexport const coveo: CoveoOptions = {\r\n  url: 'https://platform-eu.cloud.coveo.com/rest/search/v2/querySuggest',\r\n  environment: {\r\n    prod: {\r\n      organisation: 'postchagprod6ef4sbet',\r\n      token: 'xx5b629890-23b9-4fbe-b601-0e8719186969',\r\n    },\r\n    int01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    int02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev01: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    dev02: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    devs1: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n    test: {\r\n      organisation: 'postchagnonprods5sq57qt',\r\n      token: 'xx7c0e52ab-3de2-4fbd-b9a7-6ca6abd532b4',\r\n    },\r\n  },\r\n};\r\n","import { state } from '../../data/store';\r\nimport { CoveoCompletion, CoveoResponse } from '../../models/coveo.model';\r\nimport { coveo } from './coveo.settings';\r\nimport { getSearchPageUrl } from './search.service';\r\n\r\n/**\r\n * Get suggestions from coveo\r\n * https://docs.coveo.com/en/1459/build-a-search-ui/get-query-suggestions#context-object\r\n *\r\n * @param query Search term\r\n * @returns\r\n */\r\nexport const getCoveoSuggestions = async (query: string): Promise<CoveoCompletion[]> => {\r\n  if (state.localizedConfig?.header?.search === undefined) return [];\r\n  const config = state.localizedConfig.header.search;\r\n  const { token, organisation } = coveo.environment[state.environment];\r\n  const url = `${coveo.url}?q=${query}&locale=${state.currentLanguage}&searchHub=${config.searchHubName}&pipeline=${config.searchPipelineName}&organizationId=${organisation}`;\r\n  let coveoCompletions: CoveoCompletion[] | undefined;\r\n\r\n  try {\r\n    const coveoResponse = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    const coveoJSON = (await coveoResponse.json()) as CoveoResponse;\r\n    coveoCompletions = coveoJSON.completions.map(completion => ({\r\n      ...completion,\r\n      redirectUrl: getSearchPageUrl(completion.expression),\r\n    }));\r\n  } catch (error) {\r\n    console.error(\r\n      'Connection to coveo failed. Did you add \"*.coveo.com\" to your connect-src content security policy and tried turning off your adblocker?',\r\n    );\r\n  }\r\n\r\n  return coveoCompletions === undefined ? [] : coveoCompletions;\r\n};\r\n","// Implement some TOPOS logic into the header search\r\nexport const gisAPIUrl = 'https://places.post.ch/StandortSuche/StaoCacheService';\r\nexport const placesUrl = 'https://places.post.ch';\r\nexport const pois = [\r\n  '001PST',\r\n  '001MP24',\r\n  '001AG-PICK',\r\n  '001PFFIL',\r\n  '001PFST',\r\n  '001BZ',\r\n  '001LZB',\r\n  '001PZ',\r\n  '001LZP',\r\n  '001AL',\r\n];\r\n","/**\r\n * Transform to lowercase, extract accents to separate unicode chars,\r\n * replace all accent unicode chars so only standard latin chars remain\r\n * https://stackoverflow.com/questions/990904/remove-accents-diacritics-in-a-string-in-javascript/37511463#37511463\r\n *\r\n * @param str Input string\r\n * @returns\r\n */\r\nexport const hardNormalize = (str: string): string =>\r\n  str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '');\r\n","import { state } from '../../data/store';\r\nimport { GeocodeLocation, GeocodeResponse, ServiceTypesResponse } from '../../models/geocode.model';\r\nimport { gisAPIUrl, pois, placesUrl } from './places.settings';\r\nimport { hardNormalize } from './search-utilities';\r\n\r\n// Never load types twice\r\nlet typesCache: string | null = null;\r\n\r\n/**\r\n * Convert Post POI ids to stao cache ids\r\n * @returns\r\n */\r\nconst convertTypes = async () => {\r\n  if (typesCache === null) {\r\n    try {\r\n      const typesResponse = await fetch(`${gisAPIUrl}/Types?lang=${state.currentLanguage}`);\r\n      const typesJSON = (await typesResponse.json()) as ServiceTypesResponse;\r\n      typesCache = encodeURIComponent(\r\n        pois\r\n          .map(poi => {\r\n            const foundType = typesJSON.types.find(type => type.id === poi);\r\n            return foundType?.tag;\r\n          })\r\n          .filter(poi => poi !== undefined)\r\n          .join(','),\r\n      );\r\n    } catch (error) {\r\n      console.error(\r\n        'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  return typesCache;\r\n};\r\n\r\n/**\r\n * Query the Gis API for locations and localities (pois)\r\n *\r\n * @param query User input string\r\n * @returns\r\n */\r\nexport const queryPlaces = async (query: string): Promise<GeocodeLocation[]> => {\r\n  if (query.length === 0) {\r\n    return [];\r\n  }\r\n\r\n  const limit = 8;\r\n  const excludeTypes = ['address', 'locality', 'region'];\r\n  const types = await convertTypes();\r\n  const geocoderUrl = `${gisAPIUrl}/Geocode?query=${encodeURIComponent(query)}&lang=${\r\n    state.currentLanguage\r\n  }&pois=${types}&limit=33`;\r\n\r\n  try {\r\n    const geocodeResponse = await fetch(geocoderUrl);\r\n    const geocodeJSON = (await geocodeResponse.json()) as GeocodeResponse;\r\n    if (!geocodeJSON.ok) {\r\n      throw new Error(geocodeJSON.info);\r\n    }\r\n    return geocodeJSON.locations\r\n      .filter(location => !excludeTypes.includes(location.type))\r\n      .slice(0, limit);\r\n  } catch (error) {\r\n    console.error(\r\n      'Fetching places failed. Did you add \"places.post.ch\" to your connect-src content security policy?',\r\n    );\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Try to highlight place suggestions\r\n * Limitation: accented chars are not handled by this basic function\r\n *\r\n * @param query Search term\r\n * @param place Name of the suggested place\r\n * @returns\r\n */\r\nexport const highlightPlacesString = (query: string | undefined, place: string) => {\r\n  if (query === undefined) return place;\r\n\r\n  // Strip accents from the string\r\n  const reference = hardNormalize(place);\r\n  const q = hardNormalize(query);\r\n  const indexOfQuery = reference.indexOf(q);\r\n\r\n  if (indexOfQuery < 0) {\r\n    return place;\r\n  }\r\n\r\n  return `${place.substring(0, indexOfQuery)}{${place.substring(\r\n    indexOfQuery,\r\n    indexOfQuery + query.length,\r\n  )}}${place.substring(indexOfQuery + query.length, place.length)}`;\r\n};\r\n\r\n/**\r\n * Get the deeplink to any location found via geocoder\r\n *\r\n * @param location A location from the Gis API Geocode endpoint\r\n * @returns\r\n */\r\nexport const getPlacesUrl = (location: GeocodeLocation): string => {\r\n  let url: string;\r\n\r\n  if (location.id) {\r\n    url = `${placesUrl}/${state.currentLanguage}/${location.id}/detail`;\r\n  } else {\r\n    url = `${placesUrl}?preselecttext=${encodeURIComponent(location.name)}`;\r\n  }\r\n\r\n  return url;\r\n};\r\n","import { h } from '@stencil/core';\r\n\r\nexport const HighlightedText = (props: { text: string; highlightClass?: string }) => {\r\n  const highlightClass = props.highlightClass ?? 'bold';\r\n  const highlightedString = props.text\r\n    .replace(/{/g, `<span class=${highlightClass}>`)\r\n    .replace(/}/g, '</span>')\r\n    .replace(/[\\[\\]]/g, '');\r\n  return <span innerHTML={highlightedString}></span>;\r\n};\r\n","import { JSXBase } from '@stencil/core/internal';\r\n\r\nexport const If = (\r\n  props: {\r\n    condition: boolean;\r\n  },\r\n  children: JSXBase.IntrinsicElements,\r\n) => {\r\n  if (!props.condition) {\r\n    return null;\r\n  }\r\n  return children;\r\n};\r\n","@use \"@swisspost/design-system-styles/variables/color\";\r\n@use \"@swisspost/design-system-styles/components/forms\";\r\n@use \"@swisspost/design-system-styles/components/floating-label\";\r\n@use \"@swisspost/design-system-styles/components/grid\";\r\n@use \"../../utils/utils.scss\";\r\n@use \"../../utils/mixins.scss\";\r\n\r\n:host {\r\n  display: block;\r\n}\r\n\r\n.search,\r\n:host {\r\n  height: 100%;\r\n}\r\n\r\n.search-button {\r\n  @extend %nav-link;\r\n\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  padding-right: calc(1rem - 1px);\r\n  padding-left: calc(1rem - 1px);\r\n\r\n  @include mixins.min(lg) {\r\n    padding: 0 calc(1.125rem - 1px);\r\n  }\r\n\r\n  @include mixins.min(xl) {\r\n    padding: 0 calc(1.5rem - 1px);\r\n  }\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n\r\n  .visually-hidden {\r\n    @include mixins.between(rg, lg) {\r\n      @include mixins.reset-visually-hidden();\r\n\r\n      font-weight: 300;\r\n      margin-right: 0.5rem;\r\n      cursor: pointer;\r\n    }\r\n  }\r\n}\r\n\r\n.flyout {\r\n  position: absolute;\r\n  top: 100%;\r\n  left: 0;\r\n  width: 100%;\r\n  background: white;\r\n  overflow: auto;\r\n  overscroll-behavior: contain;\r\n  padding-top: 3.25rem;\r\n  padding-bottom: 3.25rem;\r\n  z-index: -1;\r\n  transform: translateY(-100%);\r\n  transition: transform 0.35s, box-shadow 0.35s;\r\n\r\n  @media (prefers-reduced-motion: reduce) {\r\n    transition: none;\r\n  }\r\n\r\n  @include mixins.min(lg) {\r\n    max-height: calc(100vh - var(--header-height) - var(--meta-header-height) - 1px);\r\n    box-shadow: 0 0 1px 0 rgb(0 0 0 / 40%);\r\n\r\n    &.open {\r\n      box-shadow: 0 0 8px 0 rgb(0 0 0 / 40%);\r\n    }\r\n  }\r\n\r\n  @include mixins.max(lg) {\r\n    height: calc(100vh - var(--header-height) - 1px);\r\n  }\r\n\r\n  &.open {\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.start-search-button {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  height: 100%;\r\n  padding-right: 1rem;\r\n  padding-left: 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n\r\n  svg {\r\n    width: 1.5rem;\r\n    height: 1.5rem;\r\n  }\r\n}\r\n\r\n.suggestions {\r\n  margin: 1.5rem 0;\r\n\r\n  a {\r\n    padding: 0.75rem 1rem;\r\n\r\n    &:hover,\r\n    &:focus,\r\n    &.selected {\r\n      background: color.$gray-background;\r\n    }\r\n\r\n    &.parcel-suggestion {\r\n      flex-wrap: wrap;\r\n    }\r\n  }\r\n}\r\n\r\n.search-recommendation__icon {\r\n  height: 1.5em;\r\n  width: 1.5em;\r\n}\r\n","import { Component, Host, h, State, Event, EventEmitter, Method, Element } from '@stencil/core';\r\nimport { throttle } from 'throttle-debounce';\r\nimport { disableBodyScroll, enableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock';\r\nimport { state } from '../../data/store';\r\nimport { CoveoCompletion } from '../../models/coveo.model';\r\nimport { GeocodeLocation } from '../../models/geocode.model';\r\nimport {\r\n  DropdownElement,\r\n  DropdownEvent,\r\n  HasDropdown,\r\n  IsFocusable,\r\n} from '../../models/header.model';\r\nimport { getSearchRedirectUrl, equalizeArrays } from '../../services/search/search.service';\r\nimport { getCoveoSuggestions } from '../../services/search/coveo.service';\r\nimport {\r\n  getPlacesUrl,\r\n  highlightPlacesString,\r\n  queryPlaces,\r\n} from '../../services/search/places.service';\r\nimport { userPrefersReducedMotion, elementHasTransition } from '../../services/ui.service';\r\nimport { HighlightedText } from '../../utils/highlighted.component';\r\nimport { SvgSprite } from '../../utils/svg-sprite.component';\r\nimport { SvgIcon } from '../../utils/svg-icon.component';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\nimport { getParcelSuggestion } from '../../services/search/parcel.service';\r\nimport { If } from '../../utils/if.component';\r\n\r\n@Component({\r\n  tag: 'post-search',\r\n  styleUrl: 'post-search.scss',\r\n  shadow: true,\r\n})\r\nexport class PostSearch implements HasDropdown, IsFocusable {\r\n  @State() searchDropdownOpen = false;\r\n  @State() coveoSuggestions: CoveoCompletion[] = [];\r\n  @State() placeSuggestions: GeocodeLocation[] = [];\r\n  @State() parcelSuggestion: (TrackAndTraceInfo & { url: string }) | null = null;\r\n  @Event() dropdownToggled: EventEmitter<DropdownEvent>;\r\n  @Element() host: DropdownElement;\r\n  private searchBox?: HTMLInputElement;\r\n  private searchFlyout: HTMLElement | undefined;\r\n  private throttledResize: throttle<() => void>;\r\n\r\n  connectedCallback() {\r\n    this.throttledResize = throttle(300, () => this.handleResize());\r\n    window.addEventListener('resize', this.throttledResize, { passive: true });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('resize', this.throttledResize);\r\n    clearAllBodyScrollLocks();\r\n  }\r\n\r\n  componentWillUpdate() {\r\n    // Check if search flyout got set to close\r\n    if (this.searchFlyout && !this.searchDropdownOpen) {\r\n      this.searchFlyout.classList.remove('open');\r\n\r\n      // Check if element has transition applied and whether user prefers to see animations or not\r\n      if (elementHasTransition(this.searchFlyout, 'transform') && !userPrefersReducedMotion()) {\r\n        // Wait for CSS transition 'transform' to end before continuing\r\n        return new Promise<boolean>(resolve => {\r\n          if (this.searchFlyout === undefined) {\r\n            return resolve(true);\r\n          }\r\n\r\n          this.searchFlyout.addEventListener('transitionend', event => {\r\n            if (event.propertyName === 'transform') {\r\n              resolve(true);\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // Search flyout got set to open\r\n    if (this.searchFlyout && this.searchDropdownOpen) {\r\n      // Force browser to redraw/refresh DOM before adding 'open' class\r\n      this.searchFlyout.getBoundingClientRect();\r\n      this.searchFlyout.classList.add('open');\r\n    }\r\n\r\n    // Focus on the searchBox whenever the dropdown is opened\r\n    if (this.searchDropdownOpen && this.searchBox) {\r\n      this.searchBox.focus({ preventScroll: true });\r\n    }\r\n  }\r\n\r\n  public async toggleDropdown(event?: Event): Promise<boolean>;\r\n  public async toggleDropdown(force?: boolean): Promise<boolean>;\r\n\r\n  /**\r\n   * Toggle the dropdown and optionally force an open/closed state\r\n   * @param force Boolean to force open/closed state\r\n   * @returns Boolean indicating open state of the component\r\n   */\r\n  @Method()\r\n  async toggleDropdown(force?: unknown) {\r\n    this.searchDropdownOpen =\r\n      force === undefined || typeof force !== 'boolean' ? !this.searchDropdownOpen : force;\r\n    this.dropdownToggled.emit({ open: this.searchDropdownOpen, element: this.host });\r\n\r\n    if (!this.searchDropdownOpen) {\r\n      // Reset suggestions when dropdown closes\r\n      this.coveoSuggestions = [];\r\n      this.placeSuggestions = [];\r\n      if (this.searchBox) this.searchBox.value = '';\r\n      this.setFocus();\r\n    } else {\r\n      // Get basic suggestions when dropdown opens\r\n      try {\r\n        this.coveoSuggestions = await getCoveoSuggestions('');\r\n      } catch {}\r\n    }\r\n\r\n    this.setBodyScroll();\r\n\r\n    return this.searchDropdownOpen;\r\n  }\r\n\r\n  /**\r\n   * Sets the focus on the search button\r\n   */\r\n  @Method()\r\n  public async setFocus() {\r\n    const shadowRoot = this.host.shadowRoot;\r\n    if (shadowRoot === null) {\r\n      return;\r\n    }\r\n    const toggleButton = shadowRoot.querySelector<HTMLElement>('.search-button');\r\n    if (toggleButton) {\r\n      toggleButton.focus();\r\n    }\r\n  }\r\n\r\n  private handleResize() {\r\n    // Only enable/disable body scroll on resize if the search dropdown is open, otherwise this could lead to side effects in other controls\r\n    if (this.searchDropdownOpen) {\r\n      this.setBodyScroll();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable or re-enable body scrolling, depending on whether search dropdown is open or closed in mobile view (width < 1024px)\r\n   */\r\n  private setBodyScroll() {\r\n    if (this.searchDropdownOpen && window.innerWidth < 1024) {\r\n      disableBodyScroll(this.searchFlyout);\r\n    } else {\r\n      enableBodyScroll(this.searchFlyout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch suggestions from all available sources\r\n   */\r\n  private async handleSearchInput() {\r\n    if (this.searchBox === undefined || state.localizedConfig?.header.search === undefined) {\r\n      return;\r\n    }\r\n    const query = this.searchBox.value.trim();\r\n\r\n    const [placeSuggestions, coveoSuggestions, trackAndTraceInfo] = await Promise.all([\r\n      queryPlaces(query),\r\n      getCoveoSuggestions(query),\r\n      getParcelSuggestion(query, state.localizedConfig.header.search),\r\n    ]);\r\n\r\n    // Parcel suggestion is more important than any other\r\n    if (trackAndTraceInfo) {\r\n      this.parcelSuggestion = trackAndTraceInfo;\r\n      this.placeSuggestions = [];\r\n      this.coveoSuggestions = [];\r\n    } else {\r\n      [this.coveoSuggestions, this.placeSuggestions] = equalizeArrays(\r\n        coveoSuggestions,\r\n        placeSuggestions,\r\n        8,\r\n      );\r\n    }\r\n\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Start search on enter\r\n   * @param event\r\n   */\r\n  private handleKeyDown(event: KeyboardEvent) {\r\n    if (this.searchFlyout === undefined) {\r\n      return;\r\n    }\r\n\r\n    let selectedSuggestion = this.searchFlyout.querySelector<HTMLElement>(\r\n      '.suggestions > li > a.selected',\r\n    );\r\n\r\n    switch (event.key.toLowerCase()) {\r\n      case 'enter':\r\n        if (selectedSuggestion) {\r\n          const selectedHref = selectedSuggestion.getAttribute('href');\r\n          if (selectedHref !== null) {\r\n            window.location.href = selectedHref;\r\n          }\r\n        } else {\r\n          this.startSearch();\r\n        }\r\n\r\n        break;\r\n      case 'arrowdown':\r\n      case 'arrowup':\r\n        const suggestions = this.searchFlyout.querySelectorAll('.suggestions > li > a');\r\n\r\n        this.deselectSuggestion();\r\n\r\n        if (event.key.toLowerCase() === 'arrowdown') {\r\n          if (selectedSuggestion?.parentElement?.nextElementSibling?.firstElementChild) {\r\n            // Select next suggestion if there's any, otherwise none will be selected\r\n            selectedSuggestion.parentElement.nextElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select first suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[0].classList.add('selected');\r\n            }\r\n          }\r\n        } else if (event.key.toLowerCase() === 'arrowup') {\r\n          if (selectedSuggestion?.parentElement?.previousElementSibling?.firstElementChild) {\r\n            // Select previous suggestion if there's any, otherwise none will be selected\r\n\r\n            selectedSuggestion.parentElement.previousElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select last suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[suggestions.length - 1].classList.add('selected');\r\n            }\r\n          }\r\n        }\r\n\r\n        // Get the newly selected suggestion\r\n        selectedSuggestion = this.searchFlyout.querySelector('.suggestions > li > a.selected');\r\n        const suggestedText = selectedSuggestion?.dataset.suggestionText;\r\n\r\n        // Update search box value with selected suggestion text\r\n        if (suggestedText !== undefined && this.searchBox) {\r\n          this.searchBox.value = suggestedText;\r\n        }\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseEnterSuggestion(event: MouseEvent) {\r\n    this.deselectSuggestion();\r\n\r\n    // Set hovered suggestion element as selected\r\n    (event.target as HTMLElement).classList.add('selected');\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseLeaveSuggestions() {\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Deselect any previously selected suggestion\r\n   */\r\n  private deselectSuggestion() {\r\n    if (this.searchFlyout === undefined) return;\r\n\r\n    const selectedSuggestion = this.searchFlyout.querySelector('.suggestions .selected');\r\n\r\n    if (selectedSuggestion) {\r\n      selectedSuggestion.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redirect to the post search page\r\n   */\r\n  private async startSearch() {\r\n    if (this.searchBox && state.localizedConfig?.header.search) {\r\n      const redirectUrl = await getSearchRedirectUrl(\r\n        this.searchBox.value.trim(),\r\n        state.localizedConfig.header.search,\r\n      );\r\n      if (!redirectUrl) return;\r\n      window.location.href = redirectUrl;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (state.localizedConfig?.header === undefined) {\r\n      return;\r\n    }\r\n    const { translations, search } = state.localizedConfig.header;\r\n    const showPortalRecommendations =\r\n      this.searchBox?.value === '' && search.searchRecommendations?.links.length > 0;\r\n\r\n    return (\r\n      <Host>\r\n        <SvgSprite />\r\n        <div class=\"search\">\r\n          <button\r\n            id=\"post-internet-header-search-button\"\r\n            class=\"search-button\"\r\n            type=\"button\"\r\n            aria-expanded={`${this.searchDropdownOpen}`}\r\n            onClick={e => this.toggleDropdown(e)}\r\n          >\r\n            <span class=\"visually-hidden\">\r\n              {this.searchDropdownOpen\r\n                ? translations.searchToggleExpanded\r\n                : translations.searchToggle}\r\n            </span>\r\n            <SvgIcon name={this.searchDropdownOpen ? 'pi-close' : 'pi-search'} />\r\n          </button>\r\n          <If condition={this.searchDropdownOpen}>\r\n            <div class=\"flyout\" ref={e => (this.searchFlyout = e)}>\r\n              <div class=\"container box\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-xs-12 col-md-10 col-lg-8\">\r\n                    <div class=\"form-group form-floating\">\r\n                      <input\r\n                        type=\"text\"\r\n                        id=\"searchBox\"\r\n                        class=\"form-control form-control-lg\"\r\n                        placeholder={translations.flyoutSearchBoxFloatingLabel}\r\n                        autocomplete=\"off\"\r\n                        ref={el => (this.searchBox = el)}\r\n                        onInput={() => this.handleSearchInput()}\r\n                        onKeyDown={e => this.handleKeyDown(e)}\r\n                      />\r\n                      <label htmlFor=\"searchBox\">{translations.flyoutSearchBoxFloatingLabel}</label>\r\n                      <button\r\n                        onClick={() => this.startSearch()}\r\n                        class=\"nav-link start-search-button\"\r\n                      >\r\n                        <span class=\"visually-hidden\">{translations.searchSubmit}</span>\r\n                        <SvgIcon name=\"pi-search\" />\r\n                      </button>\r\n                    </div>\r\n                    {showPortalRecommendations && (\r\n                      <h2 class=\"bold\">{search.searchRecommendations.title}</h2>\r\n                    )}\r\n                    <ul\r\n                      class=\"suggestions no-list\"\r\n                      onMouseLeave={() => this.handleMouseLeaveSuggestions()}\r\n                    >\r\n                      {showPortalRecommendations &&\r\n                        search.searchRecommendations.links.map(recommendation => (\r\n                          <li key={recommendation.href}>\r\n                            <a\r\n                              class=\"nav-link search-recommendation\"\r\n                              href={new URL(recommendation.href, 'https://post.ch').href}\r\n                              data-suggestion-text={recommendation.label}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <span\r\n                                class=\"search-recommendation__icon\"\r\n                                innerHTML={recommendation.inlineSvg}\r\n                              ></span>\r\n                              <span>{recommendation.label}</span>\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {this.parcelSuggestion && this.parcelSuggestion.ok && (\r\n                        <li>\r\n                          <a\r\n                            class=\"nav-link parcel-suggestion\"\r\n                            href={this.parcelSuggestion.url}\r\n                            data-suggestion-text={this.searchBox?.value}\r\n                            onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                          >\r\n                            <SvgIcon name=\"pi-letter-parcel\" />\r\n                            <span class=\"bold\">{this.parcelSuggestion?.sending?.id}:&nbsp;</span>\r\n                            <span>\r\n                              {this.parcelSuggestion?.sending?.product},{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.zipcode}{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.city},{' '}\r\n                              {this.parcelSuggestion?.sending?.state}\r\n                            </span>\r\n                          </a>\r\n                        </li>\r\n                      )}\r\n                      {!showPortalRecommendations &&\r\n                        this.coveoSuggestions &&\r\n                        this.coveoSuggestions.map(suggestion => (\r\n                          <li key={suggestion.objectId}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={suggestion.redirectUrl}\r\n                              data-suggestion-text={suggestion.expression}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-search\" />\r\n                              <HighlightedText text={suggestion.highlighted} />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {!showPortalRecommendations &&\r\n                        this.placeSuggestions &&\r\n                        this.placeSuggestions.map(suggestion => (\r\n                          <li key={suggestion.id}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={getPlacesUrl(suggestion)}\r\n                              data-suggestion-text={suggestion.name}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-place\" />\r\n                              <HighlightedText\r\n                                text={highlightPlacesString(\r\n                                  this.searchBox?.value?.trim(),\r\n                                  suggestion.name,\r\n                                )}\r\n                              />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </If>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}
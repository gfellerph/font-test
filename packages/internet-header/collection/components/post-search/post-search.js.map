{"version":3,"file":"post-search.js","sourceRoot":"","sources":["../../../../src/components/post-search/post-search.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, State, Event, EventEmitter, Method, Element } from '@stencil/core';\r\nimport { throttle } from 'throttle-debounce';\r\nimport { disableBodyScroll, enableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock';\r\nimport { state } from '../../data/store';\r\nimport { CoveoCompletion } from '../../models/coveo.model';\r\nimport { GeocodeLocation } from '../../models/geocode.model';\r\nimport {\r\n  DropdownElement,\r\n  DropdownEvent,\r\n  HasDropdown,\r\n  IsFocusable,\r\n} from '../../models/header.model';\r\nimport { getSearchRedirectUrl, equalizeArrays } from '../../services/search/search.service';\r\nimport { getCoveoSuggestions } from '../../services/search/coveo.service';\r\nimport {\r\n  getPlacesUrl,\r\n  highlightPlacesString,\r\n  queryPlaces,\r\n} from '../../services/search/places.service';\r\nimport { userPrefersReducedMotion, elementHasTransition } from '../../services/ui.service';\r\nimport { HighlightedText } from '../../utils/highlighted.component';\r\nimport { SvgSprite } from '../../utils/svg-sprite.component';\r\nimport { SvgIcon } from '../../utils/svg-icon.component';\r\nimport { TrackAndTraceInfo } from '../../models/track-and-trace.model';\r\nimport { getParcelSuggestion } from '../../services/search/parcel.service';\r\nimport { If } from '../../utils/if.component';\r\n\r\n@Component({\r\n  tag: 'post-search',\r\n  styleUrl: 'post-search.scss',\r\n  shadow: true,\r\n})\r\nexport class PostSearch implements HasDropdown, IsFocusable {\r\n  @State() searchDropdownOpen = false;\r\n  @State() coveoSuggestions: CoveoCompletion[] = [];\r\n  @State() placeSuggestions: GeocodeLocation[] = [];\r\n  @State() parcelSuggestion: (TrackAndTraceInfo & { url: string }) | null = null;\r\n  @Event() dropdownToggled: EventEmitter<DropdownEvent>;\r\n  @Element() host: DropdownElement;\r\n  private searchBox?: HTMLInputElement;\r\n  private searchFlyout: HTMLElement | undefined;\r\n  private throttledResize: throttle<() => void>;\r\n\r\n  connectedCallback() {\r\n    this.throttledResize = throttle(300, () => this.handleResize());\r\n    window.addEventListener('resize', this.throttledResize, { passive: true });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('resize', this.throttledResize);\r\n    clearAllBodyScrollLocks();\r\n  }\r\n\r\n  componentWillUpdate() {\r\n    // Check if search flyout got set to close\r\n    if (this.searchFlyout && !this.searchDropdownOpen) {\r\n      this.searchFlyout.classList.remove('open');\r\n\r\n      // Check if element has transition applied and whether user prefers to see animations or not\r\n      if (elementHasTransition(this.searchFlyout, 'transform') && !userPrefersReducedMotion()) {\r\n        // Wait for CSS transition 'transform' to end before continuing\r\n        return new Promise<boolean>(resolve => {\r\n          if (this.searchFlyout === undefined) {\r\n            return resolve(true);\r\n          }\r\n\r\n          this.searchFlyout.addEventListener('transitionend', event => {\r\n            if (event.propertyName === 'transform') {\r\n              resolve(true);\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    // Search flyout got set to open\r\n    if (this.searchFlyout && this.searchDropdownOpen) {\r\n      // Force browser to redraw/refresh DOM before adding 'open' class\r\n      this.searchFlyout.getBoundingClientRect();\r\n      this.searchFlyout.classList.add('open');\r\n    }\r\n\r\n    // Focus on the searchBox whenever the dropdown is opened\r\n    if (this.searchDropdownOpen && this.searchBox) {\r\n      this.searchBox.focus({ preventScroll: true });\r\n    }\r\n  }\r\n\r\n  public async toggleDropdown(event?: Event): Promise<boolean>;\r\n  public async toggleDropdown(force?: boolean): Promise<boolean>;\r\n\r\n  /**\r\n   * Toggle the dropdown and optionally force an open/closed state\r\n   * @param force Boolean to force open/closed state\r\n   * @returns Boolean indicating open state of the component\r\n   */\r\n  @Method()\r\n  async toggleDropdown(force?: unknown) {\r\n    this.searchDropdownOpen =\r\n      force === undefined || typeof force !== 'boolean' ? !this.searchDropdownOpen : force;\r\n    this.dropdownToggled.emit({ open: this.searchDropdownOpen, element: this.host });\r\n\r\n    if (!this.searchDropdownOpen) {\r\n      // Reset suggestions when dropdown closes\r\n      this.coveoSuggestions = [];\r\n      this.placeSuggestions = [];\r\n      if (this.searchBox) this.searchBox.value = '';\r\n      this.setFocus();\r\n    } else {\r\n      // Get basic suggestions when dropdown opens\r\n      try {\r\n        this.coveoSuggestions = await getCoveoSuggestions('');\r\n      } catch {}\r\n    }\r\n\r\n    this.setBodyScroll();\r\n\r\n    return this.searchDropdownOpen;\r\n  }\r\n\r\n  /**\r\n   * Sets the focus on the search button\r\n   */\r\n  @Method()\r\n  public async setFocus() {\r\n    const shadowRoot = this.host.shadowRoot;\r\n    if (shadowRoot === null) {\r\n      return;\r\n    }\r\n    const toggleButton = shadowRoot.querySelector<HTMLElement>('.search-button');\r\n    if (toggleButton) {\r\n      toggleButton.focus();\r\n    }\r\n  }\r\n\r\n  private handleResize() {\r\n    // Only enable/disable body scroll on resize if the search dropdown is open, otherwise this could lead to side effects in other controls\r\n    if (this.searchDropdownOpen) {\r\n      this.setBodyScroll();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Disable or re-enable body scrolling, depending on whether search dropdown is open or closed in mobile view (width < 1024px)\r\n   */\r\n  private setBodyScroll() {\r\n    if (this.searchDropdownOpen && window.innerWidth < 1024) {\r\n      disableBodyScroll(this.searchFlyout);\r\n    } else {\r\n      enableBodyScroll(this.searchFlyout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch suggestions from all available sources\r\n   */\r\n  private async handleSearchInput() {\r\n    if (this.searchBox === undefined || state.localizedConfig?.header.search === undefined) {\r\n      return;\r\n    }\r\n    const query = this.searchBox.value.trim();\r\n\r\n    const [placeSuggestions, coveoSuggestions, trackAndTraceInfo] = await Promise.all([\r\n      queryPlaces(query),\r\n      getCoveoSuggestions(query),\r\n      getParcelSuggestion(query, state.localizedConfig.header.search),\r\n    ]);\r\n\r\n    // Parcel suggestion is more important than any other\r\n    if (trackAndTraceInfo) {\r\n      this.parcelSuggestion = trackAndTraceInfo;\r\n      this.placeSuggestions = [];\r\n      this.coveoSuggestions = [];\r\n    } else {\r\n      [this.coveoSuggestions, this.placeSuggestions] = equalizeArrays(\r\n        coveoSuggestions,\r\n        placeSuggestions,\r\n        8,\r\n      );\r\n    }\r\n\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Start search on enter\r\n   * @param event\r\n   */\r\n  private handleKeyDown(event: KeyboardEvent) {\r\n    if (this.searchFlyout === undefined) {\r\n      return;\r\n    }\r\n\r\n    let selectedSuggestion = this.searchFlyout.querySelector<HTMLElement>(\r\n      '.suggestions > li > a.selected',\r\n    );\r\n\r\n    switch (event.key.toLowerCase()) {\r\n      case 'enter':\r\n        if (selectedSuggestion) {\r\n          const selectedHref = selectedSuggestion.getAttribute('href');\r\n          if (selectedHref !== null) {\r\n            window.location.href = selectedHref;\r\n          }\r\n        } else {\r\n          this.startSearch();\r\n        }\r\n\r\n        break;\r\n      case 'arrowdown':\r\n      case 'arrowup':\r\n        const suggestions = this.searchFlyout.querySelectorAll('.suggestions > li > a');\r\n\r\n        this.deselectSuggestion();\r\n\r\n        if (event.key.toLowerCase() === 'arrowdown') {\r\n          if (selectedSuggestion?.parentElement?.nextElementSibling?.firstElementChild) {\r\n            // Select next suggestion if there's any, otherwise none will be selected\r\n            selectedSuggestion.parentElement.nextElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select first suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[0].classList.add('selected');\r\n            }\r\n          }\r\n        } else if (event.key.toLowerCase() === 'arrowup') {\r\n          if (selectedSuggestion?.parentElement?.previousElementSibling?.firstElementChild) {\r\n            // Select previous suggestion if there's any, otherwise none will be selected\r\n\r\n            selectedSuggestion.parentElement.previousElementSibling.firstElementChild.classList.add(\r\n              'selected',\r\n            );\r\n          } else {\r\n            // If there are any suggestions, select last suggestion in list\r\n            if (suggestions.length > 0) {\r\n              suggestions[suggestions.length - 1].classList.add('selected');\r\n            }\r\n          }\r\n        }\r\n\r\n        // Get the newly selected suggestion\r\n        selectedSuggestion = this.searchFlyout.querySelector('.suggestions > li > a.selected');\r\n        const suggestedText = selectedSuggestion?.dataset.suggestionText;\r\n\r\n        // Update search box value with selected suggestion text\r\n        if (suggestedText !== undefined && this.searchBox) {\r\n          this.searchBox.value = suggestedText;\r\n        }\r\n\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseEnterSuggestion(event: MouseEvent) {\r\n    this.deselectSuggestion();\r\n\r\n    // Set hovered suggestion element as selected\r\n    (event.target as HTMLElement).classList.add('selected');\r\n  }\r\n\r\n  /**\r\n   * Set selected suggestion on mouse enter\r\n   * @param event\r\n   */\r\n  private handleMouseLeaveSuggestions() {\r\n    this.deselectSuggestion();\r\n  }\r\n\r\n  /**\r\n   * Deselect any previously selected suggestion\r\n   */\r\n  private deselectSuggestion() {\r\n    if (this.searchFlyout === undefined) return;\r\n\r\n    const selectedSuggestion = this.searchFlyout.querySelector('.suggestions .selected');\r\n\r\n    if (selectedSuggestion) {\r\n      selectedSuggestion.classList.remove('selected');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Redirect to the post search page\r\n   */\r\n  private async startSearch() {\r\n    if (this.searchBox && state.localizedConfig?.header.search) {\r\n      const redirectUrl = await getSearchRedirectUrl(\r\n        this.searchBox.value.trim(),\r\n        state.localizedConfig.header.search,\r\n      );\r\n      if (!redirectUrl) return;\r\n      window.location.href = redirectUrl;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (state.localizedConfig?.header === undefined) {\r\n      return;\r\n    }\r\n    const { translations, search } = state.localizedConfig.header;\r\n    const showPortalRecommendations =\r\n      this.searchBox?.value === '' && search.searchRecommendations?.links.length > 0;\r\n\r\n    return (\r\n      <Host>\r\n        <SvgSprite />\r\n        <div class=\"search\">\r\n          <button\r\n            id=\"post-internet-header-search-button\"\r\n            class=\"search-button\"\r\n            type=\"button\"\r\n            aria-expanded={`${this.searchDropdownOpen}`}\r\n            onClick={e => this.toggleDropdown(e)}\r\n          >\r\n            <span class=\"visually-hidden\">\r\n              {this.searchDropdownOpen\r\n                ? translations.searchToggleExpanded\r\n                : translations.searchToggle}\r\n            </span>\r\n            <SvgIcon name={this.searchDropdownOpen ? 'pi-close' : 'pi-search'} />\r\n          </button>\r\n          <If condition={this.searchDropdownOpen}>\r\n            <div class=\"flyout\" ref={e => (this.searchFlyout = e)}>\r\n              <div class=\"container box\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-xs-12 col-md-10 col-lg-8\">\r\n                    <div class=\"form-group form-floating\">\r\n                      <input\r\n                        type=\"text\"\r\n                        id=\"searchBox\"\r\n                        class=\"form-control form-control-lg\"\r\n                        placeholder={translations.flyoutSearchBoxFloatingLabel}\r\n                        autocomplete=\"off\"\r\n                        ref={el => (this.searchBox = el)}\r\n                        onInput={() => this.handleSearchInput()}\r\n                        onKeyDown={e => this.handleKeyDown(e)}\r\n                      />\r\n                      <label htmlFor=\"searchBox\">{translations.flyoutSearchBoxFloatingLabel}</label>\r\n                      <button\r\n                        onClick={() => this.startSearch()}\r\n                        class=\"nav-link start-search-button\"\r\n                      >\r\n                        <span class=\"visually-hidden\">{translations.searchSubmit}</span>\r\n                        <SvgIcon name=\"pi-search\" />\r\n                      </button>\r\n                    </div>\r\n                    {showPortalRecommendations && (\r\n                      <h2 class=\"bold\">{search.searchRecommendations.title}</h2>\r\n                    )}\r\n                    <ul\r\n                      class=\"suggestions no-list\"\r\n                      onMouseLeave={() => this.handleMouseLeaveSuggestions()}\r\n                    >\r\n                      {showPortalRecommendations &&\r\n                        search.searchRecommendations.links.map(recommendation => (\r\n                          <li key={recommendation.href}>\r\n                            <a\r\n                              class=\"nav-link search-recommendation\"\r\n                              href={new URL(recommendation.href, 'https://post.ch').href}\r\n                              data-suggestion-text={recommendation.label}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <span\r\n                                class=\"search-recommendation__icon\"\r\n                                innerHTML={recommendation.inlineSvg}\r\n                              ></span>\r\n                              <span>{recommendation.label}</span>\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {this.parcelSuggestion && this.parcelSuggestion.ok && (\r\n                        <li>\r\n                          <a\r\n                            class=\"nav-link parcel-suggestion\"\r\n                            href={this.parcelSuggestion.url}\r\n                            data-suggestion-text={this.searchBox?.value}\r\n                            onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                          >\r\n                            <SvgIcon name=\"pi-letter-parcel\" />\r\n                            <span class=\"bold\">{this.parcelSuggestion?.sending?.id}:&nbsp;</span>\r\n                            <span>\r\n                              {this.parcelSuggestion?.sending?.product},{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.zipcode}{' '}\r\n                              {this.parcelSuggestion?.sending?.recipient.city},{' '}\r\n                              {this.parcelSuggestion?.sending?.state}\r\n                            </span>\r\n                          </a>\r\n                        </li>\r\n                      )}\r\n                      {!showPortalRecommendations &&\r\n                        this.coveoSuggestions &&\r\n                        this.coveoSuggestions.map(suggestion => (\r\n                          <li key={suggestion.objectId}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={suggestion.redirectUrl}\r\n                              data-suggestion-text={suggestion.expression}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-search\" />\r\n                              <HighlightedText text={suggestion.highlighted} />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                      {!showPortalRecommendations &&\r\n                        this.placeSuggestions &&\r\n                        this.placeSuggestions.map(suggestion => (\r\n                          <li key={suggestion.id}>\r\n                            <a\r\n                              class=\"nav-link\"\r\n                              href={getPlacesUrl(suggestion)}\r\n                              data-suggestion-text={suggestion.name}\r\n                              onMouseEnter={e => this.handleMouseEnterSuggestion(e)}\r\n                            >\r\n                              <SvgIcon name=\"pi-place\" />\r\n                              <HighlightedText\r\n                                text={highlightPlacesString(\r\n                                  this.searchBox?.value?.trim(),\r\n                                  suggestion.name,\r\n                                )}\r\n                              />\r\n                            </a>\r\n                          </li>\r\n                        ))}\r\n                    </ul>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </If>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}